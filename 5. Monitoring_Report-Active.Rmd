---
title: "<span style='font-size: 18px'> <span style='text-align: center'> PRISMA & ReMAPP Monitoring Report (Issued: 2023-11-14)"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 4
  word_document:
    toc: yes
    toc_depth: '4'
  pdf_document:
    toc: yes
    toc_depth: '4'
    df_print: kable
always_allow_html: true
header-includes:
   - \usepackage{booktabs}
   
---
  
```{r updates, include=FALSE}
 # Last Updated: 25 October 2023
 
```

```{css, echo=FALSE}
.table caption {
  color: black;
  font-weight: bold;
}
```

#####  **PRISMA MNH:** Pregnancy Risk and Infant Surveillance and Measurement Alliance Maternal and Newborn Health (PRISMA MNH) Study: A multi-center, prospective cohort study of maternal, newborn, and infant health {.unlisted .unnumbered}

&nbsp;
&nbsp;


#####  **ReMAPP:** Redefining Maternal Anemia in Pregnancy and Postpartum (ReMAPP) Study {.unlisted .unnumbered}

&nbsp;
&nbsp;


##### **Includes data from synapse last updated:** 2023-11-17 {.unlisted .unnumbered}
&nbsp;
&nbsp;

<!-- ##### Kenya : 2023-10-13 {.unlisted .unnumbered} -->
<!-- ##### Pakistan : 2023-10-13 {.unlisted .unnumbered} -->
<!-- ##### Ghana : 2023-10-13 {.unlisted .unnumbered} -->
<!-- ##### Zambia : 2023-10-13 {.unlisted .unnumbered} -->
<!-- ##### India CMC : 2023-10-13 {.unlisted .unnumbered} -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
knitr::opts_chunk$set(out.width = "100%", fig.align = "center")

library(knitr)
library(tidyverse)
library(reshape2)
library(lubridate)
library(kableExtra)
library(emo)
library(naniar)
#library(dplyr)
library(RColorBrewer)
library(scales) 

UploadDate = "2023-11-17" 

setwd(paste0("D:/Users/stacie.loisate/Box/Monitoring-Report-Active/data/"))

## import all rda files 
rda_files = list.files(pattern="*.RData")
walk(rda_files, ~ load(.x, .GlobalEnv))


```


```{r, results='hide' }
#check last day of screening and enrollment
lastscreen <- MatData_Screen_Enroll %>%
  filter(PRESCREEN == 1) %>%
  select(M00_SCRN_OBSSTDAT, M02_SCRN_OBSSTDAT, SITE) %>%
  group_by(SITE) %>%
  mutate(last_screen = max((M00_SCRN_OBSSTDAT), na.rm = TRUE)) %>% 
  ungroup()

lastenroll <- MatData_Screen_Enroll %>%
  filter(ENROLL == 1) %>% 
  select(M00_SCRN_OBSSTDAT, M02_SCRN_OBSSTDAT, SITE) %>%
  group_by(SITE) %>%
  mutate(last_enroll = max((M02_SCRN_OBSSTDAT), na.rm = TRUE)) %>% 
  ungroup()

 table(lastscreen$last_screen, lastscreen$SITE)
 table(lastenroll$last_enroll, lastenroll$SITE)
## 

##new 
date_last_enrll_pak <- lastenroll %>% filter(SITE == "Pakistan") %>% select(last_enroll) %>%  unique() %>% mutate(last_enroll = last_enroll-7) %>% pull()
date_last_enrll_ke <- lastenroll %>% filter(SITE == "Kenya") %>% select(last_enroll) %>%  unique() %>% mutate(last_enroll = last_enroll-7) %>% pull()
date_last_enrll_ga <- lastenroll %>% filter(SITE == "Ghana") %>% select(last_enroll) %>%  unique() %>% mutate(last_enroll = last_enroll-7) %>% pull()
date_last_enrll_za <- lastenroll %>% filter(SITE == "Zambia") %>% select(last_enroll) %>%  unique() %>% mutate(last_enroll = last_enroll-7) %>% pull()
date_last_enrll_cmc <- lastenroll %>% filter(SITE == "India-CMC") %>% select(last_enroll) %>%  unique() %>% mutate(last_enroll = last_enroll-7) %>% pull()


```

##### **Last Enrollment Date: ** 
##### Kenya : 2023-11-10 {.unlisted .unnumbered}
##### Pakistan : 2023-11-03 {.unlisted .unnumbered}
##### Ghana : NA {.unlisted .unnumbered}
##### Zambia : 2023-11-08 {.unlisted .unnumbered}
##### India CMC : 2023-10-27 {.unlisted .unnumbered}

```{r Table1}
## Prescreening and enrollment in the most recent one week 
# denominator: a = n all pre-screened 
MatData_Screen_Enroll$date_last_enrll_pak = date_last_enrll_pak
MatData_Screen_Enroll$date_last_enrll_ke = date_last_enrll_ke
MatData_Screen_Enroll$date_last_enrll_ga = date_last_enrll_ga
MatData_Screen_Enroll$date_last_enrll_za = date_last_enrll_za
MatData_Screen_Enroll$date_last_enrll_cmc = date_last_enrll_cmc

tb_prescreen_enroll <- MatData_Screen_Enroll %>% 
  filter(
    SITE == "Pakistan" & (M00_SCRN_OBSSTDAT > date_last_enrll_pak) |
    SITE == "Kenya" & (M00_SCRN_OBSSTDAT > date_last_enrll_ke) | 
   SITE == "Ghana" & (M00_SCRN_OBSSTDAT > date_last_enrll_ga) |
    SITE == "Zambia" & (M00_SCRN_OBSSTDAT > date_last_enrll_za) | 
    SITE == "India-CMC" & (M00_SCRN_OBSSTDAT > date_last_enrll_cmc)  
  ) %>% 
  group_by(SITE) %>% 
  summarise("Pre-screened for PRISMA, n" = sum(PRESCREEN == 1, na.rm=TRUE),
            "Eligible based on pre-screening, n" = paste0(sum(PRESCR_ELIGIBLE == 1, na.rm=TRUE), 
                                        " (", format(sum(PRESCR_ELIGIBLE == 1, na.rm=TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Screened for PRISMA, n" = sum(SCREEN == 1),
            "Enrolled in PRISMA, n(%)" = paste0(sum(ENROLL == 1, na.rm=TRUE), 
                                        " (", format(sum(ENROLL == 1, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")")
) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .before = 1,
    "All sites" = MatData_Screen_Enroll %>% 
  filter(
    SITE == "Pakistan" & (M00_SCRN_OBSSTDAT > date_last_enrll_pak) |
    SITE == "Kenya" & (M00_SCRN_OBSSTDAT > date_last_enrll_ke) | 
   SITE == "Ghana" & (M00_SCRN_OBSSTDAT > date_last_enrll_ga) |
    SITE == "Zambia" & (M00_SCRN_OBSSTDAT > date_last_enrll_za) |
    SITE == "India-CMC" & (M00_SCRN_OBSSTDAT > date_last_enrll_cmc) 


  ) %>% 
  plyr::summarise("Pre-screened for PRISMA, n" = sum(PRESCREEN == 1, na.rm=TRUE),
            "Eligible based on pre-screening, n" = paste0(sum(PRESCR_ELIGIBLE == 1, na.rm=TRUE), 
                                        " (", format(sum(PRESCR_ELIGIBLE == 1, na.rm=TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Screened for PRISMA, n" = sum(SCREEN == 1, na.rm=TRUE),
            "Enrolled in PRISMA, n(%) ^a^" = paste0(sum(ENROLL == 1, na.rm=TRUE), 
                                        " (", format(sum(ENROLL == 1, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")")

) %>% 
      t() %>% unlist()
  ) 

# 
```

\newpage

### **1. PRISMA**

&nbsp;
&nbsp;

#### `r emo::ji("pushpin")` Table 1: Pre-screening and Enrollment numbers for PRISMA for the most recent <span style="text-decoration:underline">one week</span> 
*Value: This will provide a snapshot of weekly pre-screening and enrollment progress.* 

<!-- &nbsp; -->

```{r Table1aOut}
bind_rows(tb_prescreen_enroll) %>% 
    `rownames<-`(c("Pre-screened for PRISMA, n",
                  "Eligible based on pre-screening, n(%)  ^a^",
                  "Screened for PRISMA, n",
                  "Enrolled in PRISMA, n(%) ^b^"
                 )
               ) %>%  
  kbl(caption = "") %>%
  kable_paper(bootstrap_options = "striped", 
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = "hold_position") %>% 
  kable_styling(font_size = 13) %>% 
  # footnote(alphabet = c("Denominator is pre-screened (MNH00 completed)",
  #                       "Denominator is n screened (MNH02 completed)"))  %>% 
  pack_rows("Pre-screening (MNH00)", 1, 2, label_row_css = "color: steelblue;")  %>% 
  pack_rows("Enrollment (MNH02)", 3, 4, label_row_css = "color: steelblue;") 


```
<span style="font-size: 88%;">
^a^ Denominator is pre-screened (MNH00 completed).
<br>
^b^ Denominator is n screened (MNH02 completed).
</span>

&nbsp;
&nbsp;

\newpage

#### `r emo::ji("pushpin")` Table 2: <span style="text-decoration:underline">Cumulative</span>  pre-screening numbers for PRISMA
*Value: look at cumulative pre-screening distributions since the start of relaunch. If ineligible, distributions by exclusion criteria are listed below.*

```{r Table2}
## Cumulative Prescreening criteria 
# denominator: a = n all pre-screened 

tb_prescreen_all <- MatData_Screen_Enroll %>% 
  filter(PRESCREEN == 1) %>% 
  group_by(SITE) %>% 
  summarise("Pre-screened for PRISMA, n (MNH00)" = sum(PRESCREEN == 1, na.rm=TRUE),
            
            "Eligible based on pre-screening, n(%)^a^" = paste0(sum(PRESCR_ELIGIBLE == 1, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_ELIGIBLE == 1, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "No clinical signs of pregnancy" = paste0(sum(PRESCR_PREGSIGN == 0, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_PREGSIGN == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Viable pregnancy with GA>=25 weeks" = paste0(sum(PRESCR_GA25 == 0, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_GA25 == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Did not meet age requirement" = paste0(sum(PRESCR_AGE == 0, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_AGE == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),

            "Outside catchment area" = paste0(sum(PRESCR_CATCHAREA == 0, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_CATCHAREA == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Other reason^1^" = paste0(sum(PRESCR_OTHER == 0, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_OTHER == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Did not consent" = paste0(sum(CONSENT_PRESCREEN== 0, na.rm = TRUE), 
                                        " (", format(sum(CONSENT_PRESCREEN == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")")
) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .before = 1,
    "All sites" = MatData_Screen_Enroll %>% 
  plyr::summarise("Pre-screened for PRISMA, n (MNH00)" = sum(PRESCREEN == 1, na.rm=TRUE),
            "Eligible based on pre-screening, n(%)^a^" = paste0(sum(PRESCR_ELIGIBLE == 1, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_ELIGIBLE == 1, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1,na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "No clinical signs of pregnancy" = paste0(sum(PRESCR_PREGSIGN == 0, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_PREGSIGN == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Viable pregnancy with GA>=25 weeks" = paste0(sum(PRESCR_GA25 == 0, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_GA25 == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Did not meet age requirement" = paste0(sum(PRESCR_AGE == 0, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_AGE == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Outside catchment area" = paste0(sum(PRESCR_CATCHAREA == 0, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_CATCHAREA == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Other reason^1^" = paste0(sum(PRESCR_OTHER == 0, na.rm = TRUE), 
                                        " (", format(sum(PRESCR_OTHER == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Did not consent" = paste0(sum(CONSENT_PRESCREEN== 0, na.rm = TRUE), 
                                        " (", format(sum(CONSENT_PRESCREEN == 0, na.rm = TRUE)/sum(PRESCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")")
) %>% 
      t() %>% unlist()
  ) 
```

```{r Table2out}
bind_rows(tb_prescreen_all
          ) %>% 
  kbl(caption = "") %>%
  kable_paper(bootstrap_options = "striped", 
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = "hold_position") %>% 
  kable_styling(font_size = 13) %>%
  # footnote(alphabet = c("Denominator is pre- screened (MNH00 completed)"),
  #          number = c("Other reasons for exclusion include: not feasible to collect the minimal required dataset, medical contraindication, comes from outside the catchment area, refusal to be screened, not interested, deferred, needs to seek spousal consent, or does not have time to proceed with enrollment process"), 
  #         footnote_order = c( "number", "alphabet"))  %>% 
  pack_rows("Pre-screening", 1, 2, label_row_css = "color: steelblue;")  %>% 
  pack_rows("Reason for exclusion in pre-screening, n(%)^a^", 3, 8, label_row_css = "color: steelblue;") 
```
<span style="font-size: 88%;">
^a^ Denominator is pre- screened (MNH00 completed).
<br>
^1^ Other reasons for exclusion include: not feasible to collect the minimal required dataset, medical contraindication, comes from outside the catchment area, refusal to be screened, not interested, deferred, needs to seek spousal consent, or does not have time to proceed with enrollment process.
</span>

\newpage

&nbsp;
&nbsp;


#### `r emo::ji("pushpin")` Table 3: <span style="text-decoration:underline">Cumulative</span> enrollment numbers for PRISMA
*Value: look at cumulative enrollment and study progress distributions since the start of relaunch. If ineligible, distributions by exclusion criteria are listed below. Each column should sum to 100%.*

```{r Table3 gen}
## Cumulative Enrollment 
# denominator: a = n all screened 

tb_enroll <- MatData_Screen_Enroll %>%
  #filter(SCREEN == 1) %>% 
  group_by(SITE) %>%
  summarise("Screened for PRISMA (MNH02), n" = sum(SCREEN == 1, na.rm=TRUE),
            "Prescreen eligible (MNH00) with no Screening (MNH02), n^a^" = sum(PRESCR_ELIGIBLE ==1 & SCREEN == 0, na.rm = TRUE),
            "Enrolled in PRISMA (MNH02), n(%) ^b^" = paste0(sum(ENROLL == 1, na.rm=TRUE),
                                        " (", format(sum(ENROLL == 1, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            
              "Gestational Age at Enrollment, mean (SD)" = paste0(format(round(mean(BOE_GA_WKS_ENROLL, na.rm = TRUE),2), 
                                                        nsmall=0, digits = 2), " (",format(round(sd(BOE_GA_WKS_ENROLL, 
                                                            na.rm = TRUE),2), nsmall=0, digits = 2), ")"), 
              "First trimester (<14 wks), n(%)^c^" = paste0(sum(BOE_GA_WKS_ENROLL < 14, na.rm = TRUE)," (",
                          format(round(sum(BOE_GA_WKS_ENROLL < 14, na.rm = TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, 2), nsmall = 0, digits = 2),
    ")"),
            "Did not meet age requirement" = paste0(sum(AGE == 0, na.rm=TRUE),
                             " (", format(sum(AGE == 0, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Viable pregnancy with GA>=20 weeks by US" = paste0(sum(GA20 == 0, na.rm=TRUE),
                                " (", format(sum(GA20 == 0, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Outside catchment area" = paste0(sum(CATCHAREA == 0, na.rm=TRUE),
                                   " (", format(sum(CATCHAREA == 0, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
          "Doesn't plan to remain in catchment area" = paste0(sum(CATCHREMAIN == 0, na.rm=TRUE),
                                   " (", format(sum(CATCHREMAIN == 0, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),

            "Did not consent" = paste0(sum(CONSENT == 0, na.rm=TRUE),
                                  " (", format(sum(CONSENT == 0, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")")
  ) %>%
    t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
  add_column(
    .before = 1,
    "All sites" = MatData_Screen_Enroll %>%
  plyr::summarise("Screened for PRISMA (MNH02), n" = sum(SCREEN == 1, na.rm = TRUE),
                  "Prescreen eligible (MNH00) with no Screening (MNH02), n^a^" = sum(PRESCR_ELIGIBLE ==1 & SCREEN == 0, na.rm = TRUE),
            "Enrolled in PRISMA (MNH02), n(%) ^b^" = paste0(sum(ENROLL == 1, na.rm=TRUE),
                                        " (", format(sum(ENROLL == 1, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Gestational Age at Enrollment, mean (SD)" = paste0(format(round(mean(BOE_GA_WKS_ENROLL, na.rm = TRUE),2), 
                                                        nsmall=0, digits = 2), " (",format(round(sd(BOE_GA_WKS_ENROLL, 
                                                            na.rm = TRUE),2), nsmall=0, digits = 2), ")"), 
            "First trimester (<14 wks), n(%)^c^" = paste0(sum(BOE_GA_WKS_ENROLL < 14, na.rm = TRUE)," (",
                          format(round(sum(BOE_GA_WKS_ENROLL < 14, na.rm = TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, 2), nsmall = 0, digits = 2),
    ")"),
            "Viable pregnancy with GA>=20 weeks by US" = paste0(sum(AGE == 0, na.rm=TRUE),
                             " (", format(sum(AGE == 0, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "GA >= 20 wks by US" = paste0(sum(GA20 == 0, na.rm=TRUE),
                                " (", format(sum(GA20 == 0, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
            "Outside catchment area" = paste0(sum(CATCHAREA == 0, na.rm=TRUE),
                                   " (", format(sum(CATCHAREA == 0, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    
            "Doesn't plan to remain in catchment area" = paste0(sum(CATCHREMAIN == 0, na.rm=TRUE),
                                   " (", format(sum(CATCHREMAIN == 0, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),

            "Did not consent" = paste0(sum(CONSENT == 0, na.rm=TRUE),
                                  " (", format(sum(CONSENT == 0, na.rm=TRUE)/sum(SCREEN_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")")
      ) %>%
      t() %>% unlist()
  )



```

```{r Table3 Out}
bind_rows(tb_enroll#,
          # tb_status
          ) %>%
    `rownames<-` (c(
                 "Screened for PRISMA (MNH02), n",
                 "Prescreen eligible (MNH00) with no Screening (MNH02), n^a^",
                 "Enrolled in PRISMA (MNH02), n(%) ^b^",
                 "Gestational Age at Enrollment, mean (SD)",
                 "First trimester (<14 wks), n(%)^c^",
                 "Did not meet age requirement",
                 "Viable pregnancy with GA>=20 weeks by US", 
                 "Outside catchment area", 
                 "Does not plan to remain in catchment area", 
                 "Did not consent"
                 )
                ) %>% 
  kbl(caption = "") %>%
  kable_paper(bootstrap_options = "striped", 
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = "hold_position") %>% 
  # footnote(alphabet = c("denominator is n screened (MNH02 completed)", 
  #                       "denominator is n enrolled")
  #         )  %>% 
  kable_styling(font_size = 13) %>%
  pack_rows("Enrollment", 1, 5, label_row_css = "color: steelblue;")  %>% 
  pack_rows("Reason not enrolled, n(%)^a^", 6, 10, label_row_css = "color: steelblue;") 
```
<span style="font-size: 88%;">
^a^ n is number participants who met the eligibility criteria in MNH00 but do not have a screening form (MNH02). 
<br>
^b^ denominator is n screened (MNH02 completed).
<br>
^c^ denominator is n enrolled. 
</span>

\newpage

#### `r emo::ji("pushpin")` Figure 1a: Cumulative Enrollment by Site and Week
*Value: Illustrate cumulative enrollment status by site over time.*

```{r, echo=FALSE}
##new 

enroll_cum <- MatData_Screen_Enroll %>% 
  arrange("", by_group=START_DATE_MOM_WK) %>% 
  filter(ENROLL == 1 & !is.na(START_DATE_MOM_WK), 
         START_DATE_MOM_WK > dmy("21/09/2022")) %>% 
  group_by(SITE, START_DATE_MOM_WK) %>% 
  summarise(n = n()) %>% 
  mutate(cum_n = cumsum(n)) %>% 
  ungroup() 

enroll_cum$START_DATE_MOM_WK <- as.Date(as.POSIXct(enroll_cum$START_DATE_MOM_WK))

enroll_cum %>% 
  ggplot(aes(x = START_DATE_MOM_WK, y = cum_n, color = SITE)) +
  geom_point(shape = 15) +
  geom_line() +
  scale_x_date(date_breaks = "2 weeks", date_labels = ("%m-%d"), limits = c(dmy("25-09-2022"), UploadDate)) + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position="bottom",
        panel.grid.minor = element_blank()) +
  xlab("Enrollment Week") +
  ylab("Site Participant Enrolled") +
  ggtitle("")


```

\newpage

#### `r emo::ji("pushpin")` Figure 1b: Cumulative Enrollment by Week for Each Site
*Value: Compare expected and actual enrollment for each site over time. Calculated by dividing the total target enrollment by 36 months to get the average enrollment per month over the course of three years. We can further divide to get average enrollment per week.*

```{r, figure-side}

## pakistan
enroll_cum_PA <- MatData_Screen_Enroll %>% 
  arrange("", by_group=START_DATE_MOM_WK) %>% 
  filter(SCREEN == 1 & SITE == "Pakistan" & !is.na(START_DATE_MOM_WK), 
         START_DATE_MOM_WK > dmy("21/09/2022")) %>% 
  group_by(START_DATE_MOM_WK) %>% 
  summarise(enroll_n=sum(ENROLL==1),
            expect_n=mean(EXPECT)) %>% 
  mutate(
  gap = as.numeric(ymd(START_DATE_MOM_WK)-lag(ymd(START_DATE_MOM_WK))),
  expect_n = case_when(
    gap <= 1 ~ expect_n,
    gap > 1 ~ expect_n*gap,
    is.na(gap) ~ expect_n
  )) %>% 
  mutate(expect_cum=cumsum(expect_n),
         enroll_cum=cumsum(enroll_n))%>% 
  ungroup() 

enroll_cum_PA$START_DATE_MOM_WK <- as.Date(as.POSIXct(enroll_cum_PA$START_DATE_MOM_WK))

enroll_cum_PA %>% 
  ggplot(aes(x = START_DATE_MOM_WK)) +
  geom_point(aes(y = expect_cum, color = "Expected"), shape = 15) +
  geom_point(aes(y = enroll_cum, color = "Enrolled"), shape = 15) +
  geom_line(aes(y = expect_cum, color = "Expected")) +
  geom_line(aes(y = enroll_cum, color = "Enrolled")) +
  scale_color_manual("",
                     breaks=c("Expected","Enrolled"),
                     values = c("orange", "royalblue1")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position="bottom",
        panel.grid.minor = element_blank()) +
  scale_x_date(date_breaks = "2 weeks", date_labels = ("%m-%d"), limits = c(dmy("25-09-2022"), UploadDate)) + ## UPDATE EACH RUN
  xlab("Enrollment Week") +
  ylab("Site Participant Expected and Enrolled") +
  ggtitle("Pakistan") 

# kenya
enroll_cum_KE <- MatData_Screen_Enroll %>% 
  arrange("", by_group=START_DATE_MOM_WK) %>% 
  filter(SCREEN == 1 & SITE == "Kenya" & !is.na(START_DATE_MOM_WK), 
         START_DATE_MOM_WK > dmy("20/11/2022")) %>% 
  group_by(START_DATE_MOM_WK) %>% 
  summarise(enroll_n=sum(ENROLL==1),
            expect_n=mean(EXPECT)) %>% 
  mutate(
  gap = as.numeric(ymd(START_DATE_MOM_WK)-lag(ymd(START_DATE_MOM_WK))),
  expect_n = case_when(
    gap <= 1 ~ expect_n,
    gap > 1 ~ expect_n*gap,
    is.na(gap) ~ expect_n
  )) %>% 
  mutate(expect_cum=cumsum(expect_n),
         enroll_cum=cumsum(enroll_n))%>% 
  ungroup() 

enroll_cum_KE$START_DATE_MOM_WK <- as.Date(as.POSIXct(enroll_cum_KE$START_DATE_MOM_WK))

enroll_cum_KE %>% 
  ggplot(aes(x = START_DATE_MOM_WK)) +
  geom_point(aes(y = expect_cum, color = "Expected"), shape = 15) +
  geom_point(aes(y = enroll_cum, color = "Enrolled"), shape = 15) +
  geom_line(aes(y = expect_cum, color = "Expected")) +
  geom_line(aes(y = enroll_cum, color = "Enrolled")) +
  scale_color_manual("",
                     breaks=c("Expected","Enrolled"),
                     values = c("orange", "royalblue1")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position="bottom",
        panel.grid.minor = element_blank()) +
  scale_x_date(date_breaks = "2 weeks", date_labels = ("%m-%d"), limits = c(dmy("20-11-2022"), UploadDate)) +    
  xlab("Enrollment Week") +
  ylab("Site Participant Expected and Enrolled") +
  ggtitle("Kenya") 

## Ghana
enroll_cum_GA <- MatData_Screen_Enroll %>%
  arrange("", by_group=START_DATE_MOM_WK) %>%
  filter(SCREEN == 1 & SITE == "Ghana" & !is.na(START_DATE_MOM_WK),
         START_DATE_MOM_WK > dmy("01/01/2023")) %>%
  group_by(START_DATE_MOM_WK) %>%
  summarise(enroll_n=sum(ENROLL==1),
            expect_n=mean(EXPECT)) %>%
  mutate(
  gap = as.numeric(ymd(START_DATE_MOM_WK)-lag(ymd(START_DATE_MOM_WK))),
  expect_n = case_when(
    gap <= 1 ~ expect_n,
    gap > 1 ~ expect_n*gap,
    is.na(gap) ~ expect_n
  )) %>%
  mutate(expect_cum=cumsum(expect_n),
         enroll_cum=cumsum(enroll_n)) %>%
  ungroup()

enroll_cum_GA$START_DATE_MOM_WK <- as.Date(as.POSIXct(enroll_cum_GA$START_DATE_MOM_WK))

enroll_cum_GA %>%
  ggplot(aes(x = START_DATE_MOM_WK)) +
  geom_point(aes(y = expect_cum, color = "Expected"), shape = 15) +
  geom_point(aes(y = enroll_cum, color = "Enrolled"), shape = 15) +
  geom_line(aes(y = expect_cum, color = "Expected")) +
  geom_line(aes(y = enroll_cum, color = "Enrolled")) +
  scale_color_manual("",
                     breaks=c("Expected","Enrolled"),
                     values = c("orange", "royalblue1")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position="bottom",
        panel.grid.minor = element_blank()) +
  scale_x_date(date_breaks = "2 weeks", date_labels = ("%m-%d"), limits = c(dmy("26-12-2022"), UploadDate)) +  
  xlab("Enrollment Week") +
  ylab("Site Participant Expected and Enrolled") +
  ggtitle("Ghana")

# Zambia
enroll_cum_ZA <- MatData_Screen_Enroll %>% 
  arrange("", by_group=START_DATE_MOM_WK) %>% 
  filter(SCREEN == 1 & SITE == "Zambia" & !is.na(START_DATE_MOM_WK), 
         START_DATE_MOM_WK > dmy("15/12/2022")) %>% 
  group_by(START_DATE_MOM_WK) %>% 
  summarise(enroll_n=sum(ENROLL==1),
            expect_n=mean(EXPECT)) %>% 
  mutate(
  gap = as.numeric(ymd(START_DATE_MOM_WK)-lag(ymd(START_DATE_MOM_WK))),
  expect_n = case_when(
    gap <= 1 ~ expect_n,
    gap > 1 ~ expect_n*gap,
    is.na(gap) ~ expect_n
  )) %>% 
  mutate(expect_cum=cumsum(expect_n),
         enroll_cum=cumsum(enroll_n))%>% 
  ungroup() 

enroll_cum_ZA$START_DATE_MOM_WK <- as.Date(as.POSIXct(enroll_cum_ZA$START_DATE_MOM_WK))

enroll_cum_ZA %>% 
  ggplot(aes(x = START_DATE_MOM_WK)) +
  geom_point(aes(y = expect_cum, color = "Expected"), shape = 15) +
  geom_point(aes(y = enroll_cum, color = "Enrolled"), shape = 15) +
  geom_line(aes(y = expect_cum, color = "Expected")) +
  geom_line(aes(y = enroll_cum, color = "Enrolled")) +
  scale_color_manual("",
                     breaks=c("Expected","Enrolled"),
                     values = c("orange", "royalblue1")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position="bottom",
        panel.grid.minor = element_blank()) +
  scale_x_date(date_breaks = "2 weeks", date_labels = ("%m-%d"), limits = c(dmy("15-12-2022"), UploadDate)) + 
  xlab("Enrollment Week") +
  ylab("Site Participant Expected and Enrolled") +
  ggtitle("Zambia") 


# India CMC
enroll_cum_CMC <- MatData_Screen_Enroll %>% 
  arrange("", by_group=START_DATE_MOM_WK) %>% 
  filter(SCREEN == 1 & SITE == "India-CMC" & !is.na(START_DATE_MOM_WK), 
         START_DATE_MOM_WK > dmy("18/07/2023")) %>% 
  group_by(START_DATE_MOM_WK) %>% 
  summarise(enroll_n=sum(ENROLL==1),
            expect_n=mean(EXPECT)) %>% 
  mutate(
  gap = as.numeric(ymd(START_DATE_MOM_WK)-lag(ymd(START_DATE_MOM_WK))),
  expect_n = case_when(
    gap <= 1 ~ expect_n,
    gap > 1 ~ expect_n*gap,
    is.na(gap) ~ expect_n
  )) %>% 
  mutate(expect_cum=cumsum(expect_n),
         enroll_cum=cumsum(enroll_n))%>% 
  ungroup() 

enroll_cum_CMC$START_DATE_MOM_WK <- as.Date(as.POSIXct(enroll_cum_CMC$START_DATE_MOM_WK))

enroll_cum_CMC %>% 
  ggplot(aes(x = START_DATE_MOM_WK)) +
  geom_point(aes(y = expect_cum, color = "Expected"), shape = 15) +
  geom_point(aes(y = enroll_cum, color = "Enrolled"), shape = 15) +
  geom_line(aes(y = expect_cum, color = "Expected")) +
  geom_line(aes(y = enroll_cum, color = "Enrolled")) +
  scale_color_manual("",
                     breaks=c("Expected","Enrolled"),
                     values = c("orange", "royalblue1")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position="bottom",
        panel.grid.minor = element_blank()) +
  scale_x_date(date_breaks = "2 weeks", date_labels = ("%m-%d"), limits = c(dmy("18-07-2023"), UploadDate)) + 
  xlab("Enrollment Week") +
  ylab("Site Participant Expected and Enrolled") +
  ggtitle("India-CMC") 

```

\newpage

#### `r emo::ji("pushpin")` Table 4: Study Status for PRISMA MNH Study 
*Value: look at current status of enrolled women. Each column should sum to 100%.*

```{r Table4}
## study status 
# denominator: c = n all enrolled


tb_status <- MatData_Screen_Enroll %>% 
  filter(ENROLL == 1) %>% 
  group_by(SITE) %>% 
  summarise(
    " " = paste0("(n=", sum(ENROLL==1, na.rm = TRUE), ")"),
    "Ongoing participants" = paste0(sum(is.na(M23_CLOSE_DSDECOD)), 
                                        " (", format(sum(is.na(M23_CLOSE_DSDECOD))/sum(ENROLL_DENOM==1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Completed 1-year follow-up after live birth or stillbirth" = paste0(sum(M23_CLOSE_DSDECOD == 1, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 1, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Completed 42-day follow-up after spontaneous abortion (miscarriage) or induced abortion" = paste0(sum(M23_CLOSE_DSDECOD == 2, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 2, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Mother died before completion" = paste0(sum(M23_CLOSE_DSDECOD == 3, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 3, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Withdrew study" = paste0(sum(M23_CLOSE_DSDECOD == 4, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 4, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Terminated from study" = paste0(sum(M23_CLOSE_DSDECOD == 5, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 5, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Lost to follow-up" = paste0(sum(M23_CLOSE_DSDECOD == 6, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 6, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")")
  ) %>% 
    t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .before = 1,
    "All sites" = MatData_Screen_Enroll %>% 
      filter(ENROLL == 1) %>% 
  plyr::summarise(
    " " = paste0("(n=", sum(ENROLL == 1, na.rm = TRUE), ")"),
    "Ongoing participants" = paste0(sum(is.na(M23_CLOSE_DSDECOD)), 
                                        " (", format(sum(is.na(M23_CLOSE_DSDECOD))/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    
    "Completed 1-year follow-up after live birth or stillbirth" = paste0(sum(M23_CLOSE_DSDECOD == 1, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 1, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Completed 42-day follow-up after spontaneous abortion (miscarriage) or induced abortion" = paste0(sum(M23_CLOSE_DSDECOD == 2, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 2, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Mother died before completion" = paste0(sum(M23_CLOSE_DSDECOD == 3, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 3, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Withdrew study" = paste0(sum(M23_CLOSE_DSDECOD == 4, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 4, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Terminated from study" = paste0(sum(M23_CLOSE_DSDECOD == 5, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 5, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")"),
    "Lost to follow-up" = paste0(sum(M23_CLOSE_DSDECOD == 6, na.rm=TRUE), 
                                        " (", format(sum(M23_CLOSE_DSDECOD == 6, na.rm=TRUE)/sum(ENROLL_DENOM == 1, na.rm=TRUE)*100, digits = 2, nsmall=0), ")")
      ) %>% 
      t() %>% unlist()
  ) 
```

```{r Table4Out}
tb_status %>% 
  kbl(caption = "") %>%
  kable_paper(bootstrap_options = "striped", 
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = "hold_position") %>% 
  kable_styling(font_size = 11) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>% 
  row_spec(0:1, extra_css = "padding: 0px") %>% 
  # footnote(alphabet = c("denominator is n enrolled"
  #         ) ) %>% 
  pack_rows("Study status, n (%)^a^", 2, 8, label_row_css = "color: steelblue;") 
```
<span style="font-size: 88%;">
^a^ denominator is n enrolled.
</span>


<!-- \newpage -->

<!-- #### `r emo::ji("pushpin")` Table 5a: PRISMA Visit Completion (On-Time Windows) -->
<!-- *Value: Are forms completed for each visit? A visit is considered `complete` if the data reports the visit was conducted in person or by phone (variable name: `MAT_VISIT_MNHXX`). Goal: 80% completion (100% completion for enrollment).* -->
<!-- <br> -->

<!-- *Numerator:* Any form with visit type = i (variable name: `TYPE_VISIT`) AND have a complete visit status (variable name: `MAT_VISIT_MNHXX`) AND passed on-time window for visit type = i  -->
<!-- <br> -->
<!-- *Denominator:* Passed on-time window for visit type = i AND (has not delivered OR delivered with gestational age > visit window) AND (has not closed out OR closed out with closeout date > visit window) -->
<!-- ```{r Table 5a } -->
<!-- #* Num: Any form with visit type = i AND visit status = 1 or 2 & Passed window for visit type = i -->
<!-- #* Denom: Passed window for visit type = i -->

<!-- VISIT_COMPLETE_ANC <- Visit_Complete_Anc %>%  -->
<!--           rowwise() %>%  -->
<!--           group_by(SITE) %>%  -->
<!--           summarise( -->

<!--       "Enrollment" = paste0( -->
<!--         format(sum(VC_ENROLL_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_ENROLL_NUM == 1, na.rm = TRUE)/sum(VC_ENROLL_DENOM == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n" = paste0( -->
<!--         format(sum(VC_ENROLL_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "ANC = 20" = paste0( -->
<!--         format(sum(VC_ANC20_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_ANC20_NUM == 1, na.rm = TRUE)/sum(VC_ANC20_DENOM == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n " = paste0( -->
<!--         format(sum(VC_ANC20_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "ANC = 28" = paste0( -->
<!--         format(sum(VC_ANC28_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_ANC28_NUM == 1, na.rm = TRUE)/sum(VC_ANC28_DENOM == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n  " = paste0( -->
<!--         format(sum(VC_ANC28_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "ANC = 32" = paste0( -->
<!--         format(sum(VC_ANC32_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_ANC32_NUM == 1, na.rm = TRUE)/sum(VC_ANC32_DENOM == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n   " = paste0( -->
<!--         format(sum(VC_ANC32_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "ANC = 36" = paste0( -->
<!--         format(sum(VC_ANC36_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_ANC36_NUM == 1, na.rm = TRUE)/sum(VC_ANC36_DENOM == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n    " = paste0( -->
<!--         format(sum(VC_ANC36_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ) -->
<!--       ) %>% -->
<!--   t() %>% as.data.frame() %>%  -->
<!--   `colnames<-`(c(.[1,])) %>%  -->
<!--   slice(-1) %>%  -->
<!--       add_column( -->
<!--       .before = 1, -->
<!--       "All sites" = Visit_Complete_Anc %>%  -->
<!--         plyr::summarise( -->

<!--       "Enrollment" = paste0( -->
<!--         format(sum(VC_ENROLL_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_ENROLL_NUM == 1, na.rm = TRUE)/sum(VC_ENROLL_DENOM == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n" = paste0( -->
<!--         format(sum(VC_ENROLL_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "ANC = 20" = paste0( -->
<!--         format(sum(VC_ANC20_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_ANC20_NUM == 1, na.rm = TRUE)/sum(VC_ANC20_DENOM == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n " = paste0( -->
<!--         format(sum(VC_ANC20_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "ANC = 28" = paste0( -->
<!--         format(sum(VC_ANC28_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_ANC28_NUM == 1, na.rm = TRUE)/sum(VC_ANC28_DENOM == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n  " = paste0( -->
<!--         format(sum(VC_ANC28_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "ANC = 32" = paste0( -->
<!--         format(sum(VC_ANC32_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_ANC32_NUM == 1, na.rm = TRUE)/sum(VC_ANC32_DENOM == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n   " = paste0( -->
<!--         format(sum(VC_ANC32_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "ANC = 36" = paste0( -->
<!--         format(sum(VC_ANC36_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_ANC36_NUM == 1, na.rm = TRUE)/sum(VC_ANC36_DENOM == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n    " = paste0( -->
<!--         format(sum(VC_ANC36_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ) -->

<!--       ) %>%  -->
<!--         t() %>%  -->
<!--         as.data.frame() %>%  -->
<!--       `colnames<-`(c(.[1,])) %>% unlist()  -->
<!-- ) -->


<!-- ## PNC  -->
<!-- VISIT_COMPLETE_PNC <- Visit_Complete_Pnc %>%  -->
<!--           rowwise() %>%  -->
<!--           group_by(SITE) %>%  -->
<!--           summarise( -->

<!--       "PNC = 0" = paste0( -->
<!--         format(sum(VC_PNC0_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC0_NUM == 1, na.rm = TRUE)/sum(VC_PNC0_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n" = paste0( -->
<!--         format(sum(VC_PNC0_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "PNC = 1" = paste0( -->
<!--         format(sum(VC_PNC1_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC1_NUM == 1, na.rm = TRUE)/sum(VC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n " = paste0( -->
<!--         format(sum(VC_PNC1_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "PNC = 4" = paste0( -->
<!--         format(sum(VC_PNC4_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC4_NUM == 1, na.rm = TRUE)/sum(VC_PNC4_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n  " = paste0( -->
<!--         format(sum(VC_PNC4_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "PNC = 6" = paste0( -->
<!--         format(sum(VC_PNC6_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC6_NUM == 1, na.rm = TRUE)/sum(VC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n   " = paste0( -->
<!--         format(sum(VC_PNC6_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "PNC = 26" = paste0( -->
<!--         format(sum(VC_PNC26_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC26_NUM == 1, na.rm = TRUE)/sum(VC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n    " = paste0( -->
<!--         format(sum(VC_PNC26_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "PNC = 52" = paste0( -->
<!--         format(sum(VC_PNC52_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC52_NUM == 1, na.rm = TRUE)/sum(VC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n     " = paste0( -->
<!--         format(sum(VC_PNC52_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ) -->
<!--       ) %>% -->
<!--   t() %>% as.data.frame() %>%  -->
<!--   `colnames<-`(c(.[1,])) %>%  -->
<!--   slice(-1) %>%  -->
<!--       add_column( -->
<!--       .before = 1, -->
<!--       "All sites" = Visit_Complete_Pnc %>%  -->
<!--         plyr::summarise( -->

<!--       "PNC = 0" = paste0( -->
<!--         format(sum(VC_PNC0_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC0_NUM == 1, na.rm = TRUE)/sum(VC_PNC0_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n" = paste0( -->
<!--         format(sum(VC_PNC0_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "PNC = 1" = paste0( -->
<!--         format(sum(VC_PNC1_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC1_NUM == 1, na.rm = TRUE)/sum(VC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n " = paste0( -->
<!--         format(sum(VC_PNC1_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "PNC = 4" = paste0( -->
<!--         format(sum(VC_PNC4_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC4_NUM == 1, na.rm = TRUE)/sum(VC_PNC4_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n  " = paste0( -->
<!--         format(sum(VC_PNC4_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "PNC = 6" = paste0( -->
<!--         format(sum(VC_PNC6_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC6_NUM == 1, na.rm = TRUE)/sum(VC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n   " = paste0( -->
<!--         format(sum(VC_PNC6_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "PNC = 26" = paste0( -->
<!--         format(sum(VC_PNC26_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC26_NUM == 1, na.rm = TRUE)/sum(VC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n    " = paste0( -->
<!--         format(sum(VC_PNC26_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ), -->

<!--       "PNC = 52" = paste0( -->
<!--         format(sum(VC_PNC52_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2), -->
<!--         " (", -->
<!--         format(round(sum(VC_PNC52_NUM == 1, na.rm = TRUE)/sum(VC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2), -->
<!--         ")"), -->

<!--       "Denominator,n     " = paste0( -->
<!--         format(sum(VC_PNC52_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2) -->
<!--         ) -->
<!--       ) %>%  -->
<!--         t() %>%  -->
<!--         as.data.frame() %>%  -->
<!--       `colnames<-`(c(.[1,])) %>% unlist()  -->
<!-- ) -->

<!-- ## since no PNC data in zambia or ghana - replace with "no data"  -->
<!-- #VISIT_COMPLETE_PNC <- VISIT_COMPLETE_PNC %>%  add_column(Ghana = "No PNC Data", .after = "All sites") -->
<!-- #VISIT_COMPLETE_PNC <- VISIT_COMPLETE_PNC %>%  add_column(Zambia = "No PNC Data", .after = "Pakistan") -->

<!-- ``` -->

<!-- ```{r PRISMA TABLE 5a OUT} -->

<!-- bind_rows(VISIT_COMPLETE_ANC,  -->
<!--           VISIT_COMPLETE_PNC,  -->
<!--           ) %>%  -->
<!--   `rownames<-` (c(## anc (1-10) -->
<!--                  "Enrollment (Target window: <20wks)", -->
<!--                  "Denominator, n", -->
<!--                  "ANC = 20 (Target window: 18 to 22wks)", -->
<!--                  "Denominator, n ", -->
<!--                  "ANC = 28 (Target window: 26 to 30wks)", -->
<!--                  "Denominator, n  ", -->
<!--                  "ANC = 32 (Target window: 31 to 33wks)", -->
<!--                  "Denominator, n   ", -->
<!--                  "ANC = 36 (Target window: 34 to 38wks)", -->
<!--                  "Denominator, n    ", -->
<!--                  ## pnc (11-22) -->
<!--                  "PNC = 0 (Target window: 3 to 5 days)", -->
<!--                  "Denominator, n     ", -->
<!--                  "PNC = 1 (Target window: 7 to 14 days)", -->
<!--                  "Denominator, n      ", -->
<!--                  "PNC = 4 (Target window: 28 to 35 days)", -->
<!--                  "Denominator, n       ", -->
<!--                  "PNC = 6 (Target window: 6 to 7wks)", -->
<!--                  "Denominator, n        ", -->
<!--                  "PNC = 26 (Target window: 26 to 28wks)", -->
<!--                  "Denominator, n^1^         ", -->
<!--                  "PNC = 52 (Target window: 52 to 54wks)", -->
<!--                  "Denominator, n^1^          " -->
<!--                  ) -->
<!--                 ) %>%  -->
<!--   mutate_all(funs(str_replace(., "NaN", "0"))) %>%  -->
<!--   kbl(caption = "", booktabs = TRUE) %>% -->
<!--     # footnote(general = "Passed window denominators for all visits are calculated by EDD reported in MNH01 (US_EDD_BRTHDAT). If an EDD is missing, the particpant is removed from this table.",  -->
<!--     #          footnote_order = "general") %>%  -->
<!--   kable_paper(bootstrap_options = "striped",  -->
<!--               full_width = T, html_font = "Cambria", position = "left", -->
<!--               latex_options = c("repeat_header", "HOLD_position")) %>%  -->
<!--   kable_styling(font_size = 13) %>% -->
<!--   row_spec(0, extra_css = "border-bottom: 0px white;") %>%  -->
<!--   row_spec(c(1,3,5,7,9,11,13,15,17,19,21), extra_css = "border-bottom: 0px white;") %>%  -->
<!--   add_indent(c(2, 4, 6,8,10, 12, 14,16,18,20,22), level_of_indent = 2)  %>%  -->
<!--   pack_rows("ANC Visits", 1, 10, label_row_css = "color: steelblue;") %>%  -->
<!--   pack_rows("PNC Visits", 11, 22, label_row_css = "color: steelblue;")  -->

<!-- ``` -->
<!-- <span style="font-size: 88%;"> -->
<!-- ^1^ Excludes participants with a reported miscarriage `(FETAL_LOSS_DSDECOD==1 [MNH04])` who are only expected to have PNC0-6. -->
<!-- <br> -->
<!-- Note: Passed window denominators for all visits are calculated by EDD reported in MNH01 (US_EDD_BRTHDAT). If an EDD is missing, the participant is removed from this table. -->
<!-- </span> -->

\newpage

#### `r emo::ji("pushpin")` Table 5: PRISMA Visit Completion (Late Windows) 
*Value: Are forms completed for each visit? A visit is considered `complete` if the data reports the visit was conducted in person or by phone (variable name: `MAT_VISIT_MNHXX`). If there is no late window for a visit, the on-time windows are used. Goal: 90% completion (100% completion for enrollment)*
<br>

*Numerator:* Any form with visit type = i (variable name: `TYPE_VISIT`) AND have a complete visit status (variable name: `MAT_VISIT_MNHXX`) AND passed late window for visit type = i
<br>
*Denominator:* Passed late window for visit type = i  AND (has not delivered OR delivered with gestational age > late visit window) AND (has not closed out OR closed out with closeout date > visit window)
```{r Table 5 }
#* Num: Any form with visit type = i AND visit status = 1 or 2 & Passed window for visit type = i
#* Denom: Passed window for visit type = i

VISIT_COMPLETE_ANC <- Visit_Complete_Anc %>%
          rowwise() %>%
          group_by(SITE) %>%
          summarise(

      "Enrollment" = paste0(
        format(sum(VC_ENROLL_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_ENROLL_NUM_LATE == 1, na.rm = TRUE)/sum(VC_ENROLL_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n" = paste0(
        format(sum(VC_ENROLL_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "ANC = 20" = paste0(
        format(sum(VC_ANC20_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_ANC20_NUM_LATE == 1, na.rm = TRUE)/sum(VC_ANC20_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n " = paste0(
        format(sum(VC_ANC20_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "ANC = 28" = paste0(
        format(sum(VC_ANC28_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_ANC28_NUM_LATE == 1, na.rm = TRUE)/sum(VC_ANC28_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n  " = paste0(
        format(sum(VC_ANC28_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "ANC = 32" = paste0(
        format(sum(VC_ANC32_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_ANC32_NUM_LATE == 1, na.rm = TRUE)/sum(VC_ANC32_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n   " = paste0(
        format(sum(VC_ANC32_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "ANC = 36" = paste0(
        format(sum(VC_ANC36_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_ANC36_NUM_LATE == 1, na.rm = TRUE)/sum(VC_ANC36_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n    " = paste0(
        format(sum(VC_ANC36_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        )
      ) %>%
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Visit_Complete_Anc %>%
        plyr::summarise(

      "Enrollment" = paste0(
        format(sum(VC_ENROLL_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_ENROLL_NUM_LATE == 1, na.rm = TRUE)/sum(VC_ENROLL_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n" = paste0(
        format(sum(VC_ENROLL_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "ANC = 20" = paste0(
        format(sum(VC_ANC20_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_ANC20_NUM_LATE == 1, na.rm = TRUE)/sum(VC_ANC20_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n " = paste0(
        format(sum(VC_ANC20_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "ANC = 28" = paste0(
        format(sum(VC_ANC28_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_ANC28_NUM_LATE == 1, na.rm = TRUE)/sum(VC_ANC28_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n  " = paste0(
        format(sum(VC_ANC28_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "ANC = 32" = paste0(
        format(sum(VC_ANC32_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_ANC32_NUM_LATE == 1, na.rm = TRUE)/sum(VC_ANC32_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n   " = paste0(
        format(sum(VC_ANC32_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "ANC = 36" = paste0(
        format(sum(VC_ANC36_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_ANC36_NUM_LATE == 1, na.rm = TRUE)/sum(VC_ANC36_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n    " = paste0(
        format(sum(VC_ANC36_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        )

      ) %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


## PNC
VISIT_COMPLETE_PNC <- Visit_Complete_Pnc %>%
          rowwise() %>%
          group_by(SITE) %>%
          summarise(

      "PNC = 0" = paste0(
        format(sum(VC_PNC0_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC0_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC0_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n" = paste0(
        format(sum(VC_PNC0_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "PNC = 1" = paste0(
        format(sum(VC_PNC1_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC1_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC1_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n " = paste0(
        format(sum(VC_PNC1_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "PNC = 4" = paste0(
        format(sum(VC_PNC4_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC4_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC4_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n  " = paste0(
        format(sum(VC_PNC4_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "PNC = 6" = paste0(
        format(sum(VC_PNC6_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC6_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC6_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n   " = paste0(
        format(sum(VC_PNC6_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "PNC = 26" = paste0(
        format(sum(VC_PNC26_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC26_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC26_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n    " = paste0(
        format(sum(VC_PNC26_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "PNC = 52" = paste0(
        format(sum(VC_PNC52_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC52_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC52_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n     " = paste0(
        format(sum(VC_PNC52_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        )
      ) %>%
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Visit_Complete_Pnc %>%
        plyr::summarise(

      "PNC = 0" = paste0(
        format(sum(VC_PNC0_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC0_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC0_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n" = paste0(
        format(sum(VC_PNC0_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "PNC = 1" = paste0(
        format(sum(VC_PNC1_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC1_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC1_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n " = paste0(
        format(sum(VC_PNC1_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "PNC = 4" = paste0(
        format(sum(VC_PNC4_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC4_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC4_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n  " = paste0(
        format(sum(VC_PNC4_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "PNC = 6" = paste0(
        format(sum(VC_PNC6_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC6_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC6_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n   " = paste0(
        format(sum(VC_PNC6_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "PNC = 26" = paste0(
        format(sum(VC_PNC26_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC26_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC26_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n    " = paste0(
        format(sum(VC_PNC26_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "PNC = 52" = paste0(
        format(sum(VC_PNC52_NUM_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(VC_PNC52_NUM_LATE == 1, na.rm = TRUE)/sum(VC_PNC52_DENOM_LATE==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "Denominator,n     " = paste0(
        format(sum(VC_PNC52_DENOM_LATE==1, na.rm = TRUE), nsmall = 0, digits = 2)
        )
      ) %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)

```

```{r PRISMA TABLE 5 OUT}

bind_rows(VISIT_COMPLETE_ANC,
          VISIT_COMPLETE_PNC,
          ) %>%
  `rownames<-` (c(## anc (1-10)
                 "Enrollment (Late window: None)", ## NONE - SKIP WINDOW
                 "Denominator, n",
                 "ANC = 20 (Late window: 23 to 25wks)",
                 "Denominator, n ",
                 "ANC = 28 (Late window: None)", ## NONE - SKIP WINDOW
                 "Denominator, n  ",
                 "ANC = 32 (Late window: 31 to 33)", ## use on time windows
                 "Denominator, n   ",
                 "ANC = 36 (Late window: 38 to delivery)", ## use on time windows
                 "Denominator, n    ",
                 ## pnc (11-22)
                 "PNC = 0 (Late window: None)", ## NONE - SKIP WINDOW
                 "Denominator, n     ",
                 "PNC = 1 (Late window: None)", ## NONE - SKIP WINDOW
                 "Denominator, n      ",
                 "PNC = 4 (Late window: None)", ## NONE - SKIP WINDOW
                 "Denominator, n       ",
                 "PNC = 6 (Late window: 8 to 12wks)",
                 "Denominator, n        ",
                 "PNC = 26 (Late window: 29 to 39wks)",
                 "Denominator, n^1^         ",
                 "PNC = 52 (Late window: 55 to 64wks)",
                 "Denominator, n^1^          "
                 )
                ) %>%
  mutate_all(funs(str_replace(., "NaN", "0"))) %>%
  kbl(caption = "", booktable = TRUE) %>%
    # footnote(general = "Passed late window denominators for all visits are calculated by EDD reported in MNH01 (US_EDD_BRTHDAT). If an EDD is missing, the particpant is removed from this table.",
    #          footnote_order = "general") %>%
  kable_paper(bootstrap_options = "striped",
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = c("repeat_header", "HOLD_position")) %>%
  kable_styling(font_size = 13) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>%
  row_spec(c(1,3,5,7,9,11,13,15,17,19,21), extra_css = "border-bottom: 0px white;") %>%
  #row_spec(c(2, 4, 6,8,10, 12, 14,16,18,20,22), italic = TRUE) %>%
  add_indent(c(2, 4, 6,8,10, 12, 14,16,18,20,22), level_of_indent = 2)  %>%
  pack_rows("ANC Visits", 1, 10, label_row_css = "color: steelblue;") %>%
  pack_rows("PNC Visits", 11, 22, label_row_css = "color: steelblue;")

```
<span style="font-size: 88%;">
^1^ Excludes participants with a reported miscarriage `(FETAL_LOSS_DSDECOD==1 [MNH04])` who are only expected to have PNC0-6.
<br>
Note: Passed late window denominators for all visits are calculated by EDD reported in MNH01 (US_EDD_BRTHDAT). If an EDD is missing, the participant is removed from this table.
</span>

\newpage

#### `r emo::ji("pushpin")` Table 6: ANC Protocol Compliance
*Value: Among women successfully contacted during the ANC period, are all expected forms for the visit complete? A visit is considered `complete` if the data reports the visit was conducted in person or by phone (variable name: `MAT_VISIT_MNHXX`). Goal: 100% completion for all forms, except MNH08 where lab results are expected to lag.*
<br>

*Numerator:* By form: visit type = i (variable name: `TYPE_VISIT`) AND have a complete visit status (variable name: `MAT_VISIT_MNHXX`) AND passed late window for visit type = i 
<br>
*Denominator:* Any form with visit type = i (variable name: `TYPE_VISIT`) AND have a complete visit status (variable name: `MAT_VISIT_MNHXX`) AND passed latewindow for visit type = i 

```{r ga_tb PC}
## ANC visits - ultrasound form  
# denominator: c = n all screened 

ga_tb <- MatData_Anc_Visits %>% 
  group_by(SITE) %>% 
  summarise(
  "total enrolled" = paste0(
    "(n=",sum(ENROLL_DENOM==1, na.rm = TRUE), ")"
  )
  ) %>% ungroup() %>% 
  #mutate(`Gestational Age at Enrollment, mean ± SD` = ifelse(SITE == "Ghana", NA, `Gestational Age at Enrollment, mean ± SD`)) %>% 
  t() %>% 
  as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .before = 1,
    "All sites" = MatData_Anc_Visits %>%
 # mutate(BOE_GA_WKS_ENROLL = ifelse(SITE == "Ghana", NA, BOE_GA_WKS_ENROLL)) %>% 
 plyr::summarise(
     "total enrolled" = paste0(
    "(n=",sum(ENROLL_DENOM==1, na.rm = TRUE),")"
  )
  ) %>% 
      t() %>% as.data.frame() %>% unlist()
  ) 


```

```{r ENROLLMENT PC}

#* Num (hard code in monitoring report rmd): For each form: visit type = i AND visit status = 1 or 2 AND passed window for visit type = i 
#* Denom: Any form with visit type = i AND visit status = 1 or 2 AND passed window for visit type = i 

ENROLLMENT <- Prot_Compliance_Anc %>% 
    rowwise() %>% 
    group_by(SITE) %>% 
    summarise(
      "Denominator" = paste0(
        format(sum(PC_ENROLL_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),
      
      "MNH01 Ultrasound" = paste0(
        format(sum(M01_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M01_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH02 Enrollment Status" = paste0(
        format(sum(ENROLL == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(ENROLL == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      "MNH03 Sociodemographic" = paste0(
        format(sum(M03_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M03_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH04 ANC Clinical Status" = paste0(
        format(sum(M04_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M04_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(M05_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(M07_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
      add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Anc %>% 
        plyr::summarise(
          
      "Denominator" = paste0(
        format(sum(PC_ENROLL_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH01 Ultrasound" = paste0(
        format(sum(M01_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M01_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH02 Enrollment Status" = paste0(
        format(sum(ENROLL == 1& ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(ENROLL == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH03 Sociodemographic" = paste0(
        format(sum(M03_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M03_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(M04_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M04_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(M05_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(M07_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # 
       "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_1 == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(PC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>% 
        t() %>% 
        as.data.frame() %>% 
      `colnames<-`(c(.[1,])) %>% unlist() 
)


```

```{r ANC20 PC}
#* Num (hard code in monitoring report rmd): For each form: visit type = i AND visit status = 1 or 2 AND passed window for visit type = i 
#* Denom: Any form with visit type = i AND visit status = 1 or 2 AND passed window for visit type = i 

ANC20 <- Prot_Compliance_Anc %>% 
    filter(BOE_GA_WKS_ENROLL <= 17) %>% 
    rowwise() %>% 
    group_by(SITE) %>% 
    summarise(

    "Denominator" = paste0(
        format(sum(PC_ANC20_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),
        
    "MNH01 Ultrasound (optional)" = paste0(
        format(sum(M01_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M01_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
    
      "MNH04 ANC Clinical Status" = paste0(
        format(sum(M04_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M04_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(M05_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(M07_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
       "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")

      # "MNH25 Maternal Depression" = paste0(
      #   format(sum(M25_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(M25_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      # 
      #  "MNH26 Maternal Fatigue" = paste0(
      #   format(sum(!is.na(M26_VISIT_COMPLETE_2)  & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M26_VISIT_COMPLETE_2)  & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")")
      # 
    ) %>%
    t() %>% 
    as.data.frame() %>%    
        `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
    add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Anc %>%
      filter(BOE_GA_WKS_ENROLL <= 17) %>% 
        plyr::summarise(
          
      "Denominator" = paste0(
        format(sum(PC_ANC20_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),
          
      "MNH01 Ultrasound (optional)" = paste0(
        format(sum(M01_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M01_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
    
      "MNH04 ANC Clinical Status" = paste0(
        format(sum(M04_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M04_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(M05_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(M07_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # 
       "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")

      # "MNH25 Maternal Depression" = paste0(
      #   format(sum(M25_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(M25_VISIT_COMPLETE_2 == 1 & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      # 
      #  "MNH26 Maternal Fatigue" = paste0(
      #   format(sum(!is.na(M26_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M26_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(PC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")")
      ) %>%
        
        t() %>% as.data.frame() %>% unlist() 
)

```

```{r ANC 28 PC}
#* Num (hard code in monitoring report rmd): For each form: visit type = i AND visit status = 1 or 2 AND passed window for visit type = i 
#* Denom: Any form with visit type = i AND visit status = 1 or 2 AND passed window for visit type = i 

ANC28 <- Prot_Compliance_Anc %>% 
    rowwise() %>% 
    group_by(SITE) %>% 
    summarise(
      
      "Denominator" = paste0(
        format(sum(PC_ANC28_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),
        
       "MNH01 Ultrasound (optional)" = paste0(
        format(sum(M01_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M01_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(M04_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M04_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(M05_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(M07_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% `colnames<-`(c(.[1,]))  %>% as.data.frame() %>% 
  slice(-1) %>% 
      add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Anc %>% 
        plyr::summarise(
          
      "Denominator" = paste0(
        format(sum(PC_ANC28_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

       "MNH01 Ultrasound (optional)" = paste0(
        format(sum(M01_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M01_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(M04_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M04_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(M05_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(M07_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # 
       "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_3 == 1 & ANC28_PASS == 1, na.rm = TRUE)/sum(PC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>% 
        t() %>% `colnames<-`(c(.[1,])) %>% 
        as.data.frame() %>% unlist() 
)

```

```{r ANC 32 PC}
#* Num (hard code in monitoring report rmd): For each form: visit type = i AND visit status = 1 or 2 AND passed window for visit type = i 
#* Denom: Any form with visit type = i AND visit status = 1 or 2 AND passed window for visit type = i 

ANC32 <- Prot_Compliance_Anc %>% 
    rowwise() %>% 
    group_by(SITE) %>% 
    summarise(
    
  "Denominator" = paste0(
        format(sum(PC_ANC32_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),
        
   "MNH01 Ultrasound" = paste0(
        format(sum(M01_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M01_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(M04_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M04_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(M05_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(M07_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      # "MNH25 Maternal Lab" = paste0(
      #   format(sum(M25_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(M25_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"), 
      # 
      # "MNH26 Maternal Fatigue" = paste0(
      #   format(sum(!is.na(M26_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M26_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")")
  
  ) %>%

  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,]))  %>% 
  slice(-1) %>% 
      add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Anc %>% 
        plyr::summarise(
          
  "Denominator" = paste0(
        format(sum(PC_ANC32_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),
        
    "MNH01 Ultrasound" = paste0(
        format(sum(M01_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M01_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(M04_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M04_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(M05_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(M07_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # 
       "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")
      # "MNH25 Maternal Lab" = paste0(
      #   format(sum(M25_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(M25_VISIT_COMPLETE_4 == 1 & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      # 
      # "MNH26 Maternal Fatigue" = paste0(
      #   format(sum(!is.na(M26_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M26_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(PC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")")
  
  ) %>%

        t() %>% 
        as.data.frame() %>% 
      `colnames<-`(c(.[1,])) %>%  unlist() 
)

```

```{r ANC36 PC}
#* Num (hard code in monitoring report rmd): For each form: visit type = i AND visit status = 1 or 2 AND passed window for visit type = i 
#* Denom: Any form with visit type = i AND visit status = 1 or 2 AND passed window for visit type = i 

ANC36 <- Prot_Compliance_Anc %>% 
    rowwise() %>% 
    group_by(SITE) %>% 
    summarise(
                
       "Denominator" = paste0(
        format(sum(PC_ANC36_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),
  
       "MNH01 Ultrasound (optional)" = paste0(
        format(sum(M01_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M01_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),


      "MNH04 ANC Clinical Status" = paste0(
        format(sum(M04_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M04_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(M05_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(M07_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% `colnames<-`(c(.[1,]))  %>% as.data.frame() %>% 
  slice(-1) %>% 
      add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Anc %>% 
        plyr::summarise(
          
       "Denominator" = paste0(
        format(sum(PC_ANC36_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),
          
       "MNH01 Ultrasound (optional)" = paste0(
        format(sum(M01_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M01_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(M04_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M04_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(M05_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(M07_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # 
       "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_5 == 1 & ANC36_PASS == 1, na.rm = TRUE)/sum(PC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
        t() %>% `colnames<-`(c(.[1,])) %>% 
        as.data.frame() %>% unlist() 
)

```

```{r PRISMA TABLE 6 OUT}

bind_rows(ga_tb, 
          ENROLLMENT, 
          ANC20,
          ANC28, 
          ANC32, 
          ANC36
          ) %>% 
  `rownames<-`(c(" ",
                 ## ANCLESS20 (2-10)
                 "Denominator, n",
                 "MNH01 Ultrasound", 
                 "MNH02 Enrollment Status", 
                 "MNH03 Sociodemographic", 
                 "MNH04 ANC Clinical Status",
                 "MNH05 Maternal Anthropometry",
                 "MNH06 Maternal POC",
                 "MNH07 Maternal Specimen",
                 "MNH08 Maternal Lab",
                 ## ANC20 (11-17)
                 "Denominator, n ",                 
                 "MNH01 Ultrasound (optional) ",
                 "MNH04 ANC Clinical Status ",
                 "MNH05 Maternal Anthropometry ",
                 "MNH06 Maternal POC ",
                 "MNH07 Maternal Specimen ",
                 "MNH08 Maternal Lab ",
                 #"MNH25 Maternal Depression ",
                 #"MNH26 Maternal Fatigue^1^ ",
                 ## ANC28 (18-24)
                 "Denominator, n  ",                 
                 "MNH01 Ultrasound (optional)  ",
                 "MNH04 ANC Clinical Status  ",
                 "MNH05 Maternal Anthropometry  ",
                 "MNH06 Maternal POC  ",
                 "MNH07 Maternal Specimen  ",
                 "MNH08 Maternal Lab  ",
                 ## ANC32 (25-31)
                 "Denominator, n   ",                 
                 "MNH01 Ultrasound   ",
                 "MNH04 ANC Clinical Status   ",
                 "MNH05 Maternal Anthropometry   ",
                 "MNH06 Maternal POC   ",
                 "MNH07 Maternal Specimen   ",
                 "MNH08 Maternal Lab   ",
                 #"MNH25 Maternal Depression   ",
                 #"MNH26 Maternal Fatigue^1^   ",
                 ##ANC36 (32-38)
                 "Denominator, n    ",                 
                 "MNH01 Ultrasound (optional)    ",
                 "MNH04 ANC Clinical Status    ",
                 "MNH05 Maternal Anthropometry    ",
                 "MNH06 Maternal POC    ",
                 "MNH07 Maternal Specimen    ",
                 "MNH08 Maternal Lab    "
                 )
               )  %>% 
  mutate_all(funs(str_replace(., "NaN", "0"))) %>% 
  kbl(caption = "", booktabs = TRUE) %>%  
    # footnote(alphabet = c("denominator is n completed any form with visit status=complete AND visit type=Enrollment AND passed late window with >19 weeks gestation",
    #                   "denominator is n completed any form with visit status=complete AND visit type=ANC20 AND passed late window with >22 weeks gestation",
    #                   "denominator is n completed any form with visit status=complete AND visit type=ANC28  AND passed late window with >30 weeks gestation",
    #                   "denominator is n completed any form with visit status=complete AND visit type=ANC32  AND passed late window with>33 weeks gestation",
    #                   "denominator is n completed any form with visit status=complete AND visit type=ANC36  AND passed late window with >38 weeks gestation"),
    #          general = "Passed window denominators for all visits are calculated by EDD reported in MNH01 (US_EDD_BRTHDAT). If an EDD is missing, the participant is removed from this table.",
    #          number = "MNH26 is only filled out for ReMAPP participants",
    #          footnote_order = c("alphabet","number", "general")) %>% 
  kable_paper(bootstrap_options = "striped", 
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = c("repeat_header", "HOLD_position")) %>% 
  kable_styling(font_size = 13) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>% 
  row_spec(0:1, extra_css = "padding: 0.1px") %>% 
  row_spec(c(2,11,18,25,32), bold = TRUE) %>% 
  pack_rows(paste0("Enrollment, n(%)^a^ \nTarget window: <20wks"),2, 10, 
            label_row_css = "color: steelblue;") %>% 
  pack_rows("ANC = 20, n(%)^b^ \nTarget window: 18 to 22wks", 11, 17, 
            label_row_css = "color: steelblue;") %>% 
  pack_rows("ANC = 28, n(%)^c^ \nTarget window: 26 to 30wks", 18, 24,
            label_row_css = "color: steelblue;") %>% 
  pack_rows("ANC = 32, n(%)^d^ \nTarget window: 31 to 33wks", 25, 31,
            label_row_css = "color: steelblue;") %>% 
  pack_rows("ANC = 36, n(%)^d^ \nTarget window: 34 to 38wks", 32, 38,
            label_row_css = "color: steelblue;") 

```
<span style="font-size: 88%;">
^a^ denominator is n completed any form with visit status=complete AND visit type=Enrollment AND passed late window with >19 weeks gestation.
<br>
^b^ denominator is n completed any form with visit status=complete AND visit type=ANC20 AND passed late window with >22 weeks gestation. 
<br>
^c^ denominator is n completed any form with visit status=complete ANDvisit type=ANC28  AND passed late window with >30 weeks gestation. 
<br>
^d^ denominator is n completed any form with visit status=complete AND visit type=ANC32  AND passed late window with>33 weeks gestation. 
<br>
^e^ denominator is n completed any form with visit status=complete AND visit type=ANC36  AND passed late window with >38 weeks gestation. 
<br>
^1^MNH26 is only filled out for ReMAPP participants. 
<br>
Note: Passed window denominators for all visits are calculated by EDD reported in MNH01 (US_EDD_BRTHDAT). If an EDD is missing, the participant is removed from this table.
</span>

\newpage

#### `r emo::ji("pushpin")` Table 7: ANC Form Completion
*Value: Are forms completed regardless of visit status? Goal: 100% completion for all forms, except MNH08 where lab results are expected to lag.*
<br>

*Numerator:* By form: visit type = i (variable name: `TYPE_VISIT`) AND have any visit status (variable name: `MAT_VISIT_MNHXX`) AND passed late window for visit type = i 
<br>
*Denominator:* Any form with visit type = i (variable name: `TYPE_VISIT`) AND have any visit status (variable name: `MAT_VISIT_MNHXX`) AND passed late window for visit type = i 

```{r ga_tb FC}
## ANC visits - ultrasound form  
# denominator: c = n all screened 
# Participants are included in the numerator of this table if, for each form, they have visit type = i AND have any visit status AND passed window for visit type = 1. Participants  are included Visit status is defined by MAT_VISIT_MNHxx variables in each form.*
ga_tb <- MatData_Anc_Visits %>% 
  group_by(SITE) %>% 
  summarise(
  "total enrolled" = paste0(
    "(n=",sum(ENROLL==1, na.rm=TRUE), ")"
  )
  ) %>% ungroup() %>% 
  t() %>% 
  as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .before = 1,
    "All sites" = MatData_Anc_Visits %>%
 plyr::summarise(
     "total enrolled" = paste0(
    "(n=",sum(ENROLL==1, na.rm=TRUE),")"
  )) %>% 
      t() %>% as.data.frame() %>% unlist()
  ) 


```

```{r ENROLLMENT FC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i 
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

ENROLLMENT <- Form_Completion_Anc %>% 
    rowwise() %>% 
    group_by(SITE) %>% 
    summarise(
      "Denominator" = paste0(
        format(sum(FC_ENROLL_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH01 Ultrasound" = paste0(
        format(sum(!is.na(M01_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M01_VISIT_COMPLETE_1)& ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH02 Enrollment Status" = paste0(
        format(sum(ENROLL == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(ENROLL == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      "MNH03 Sociodemographic" = paste0(
        format(sum(!is.na(M03_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M03_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH04 ANC Clinical Status" = paste0(
        format(sum(!is.na(M04_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M04_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
      add_column(
      .before = 1,
      "All sites" = Form_Completion_Anc %>% 
        plyr::summarise(
        
      "Denominator" = paste0(
        format(sum(FC_ENROLL_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),  
      
      "MNH01 Ultrasound" = paste0(
        format(sum(!is.na(M01_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M01_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH02 Enrollment Status" = paste0(
        format(sum(ENROLL == 1 & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(ENROLL == 1 & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH03 Sociodemographic" = paste0(
        format(sum(!is.na(M03_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M03_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(!is.na(M04_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M04_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # 
       "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_1) & ENROLL_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>% 
        t() %>% 
        as.data.frame() %>% 
      `colnames<-`(c(.[1,])) %>% unlist() 
)


```

```{r ANC20 FC}
#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i 
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

ANC20 <- Form_Completion_Anc %>% 
    filter(BOE_GA_WKS_ENROLL <= 17) %>% 
    rowwise() %>% 
    group_by(SITE) %>% 
    summarise(
      
    "Denominator" = paste0(
        format(sum(FC_ANC20_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ), 
      
    "MNH01 Ultrasound (optional)" = paste0(
        format(sum(!is.na(M01_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M01_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
    
      "MNH04 ANC Clinical Status" = paste0(
        format(sum(!is.na(M04_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M04_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
       "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH25 Maternal Depression" = paste0(
        format(sum(!is.na(M25_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M25_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

       "MNH26 Maternal Fatigue" = paste0(
        format(sum(!is.na(M26_VISIT_COMPLETE_2)  & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M26_VISIT_COMPLETE_2)  & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
    t() %>% 
    as.data.frame() %>%    
        `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
    add_column(
      .before = 1,
      "All sites" = Form_Completion_Anc %>% 
      filter(BOE_GA_WKS_ENROLL <= 17) %>% 
        plyr::summarise(
                
    "Denominator" = paste0(
        format(sum(FC_ANC20_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ), 
    
      "MNH01 Ultrasound (optional)" = paste0(
        format(sum(!is.na(M01_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M01_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
    
      "MNH04 ANC Clinical Status" = paste0(
        format(sum(!is.na(M04_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M04_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # 
       "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH25 Maternal Depression" = paste0(
        format(sum(!is.na(M25_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M25_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

       "MNH26 Maternal Fatigue" = paste0(
        format(sum(!is.na(M26_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M26_VISIT_COMPLETE_2) & ANC20_PASS == 1, na.rm = TRUE)/sum(FC_ANC20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
        
        t() %>% as.data.frame() %>% unlist() 
)

```

```{r ANC 28 FC}
#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i 
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

ANC28 <- Form_Completion_Anc %>% 
    rowwise() %>% 
    group_by(SITE) %>% 
    summarise(
            
    "Denominator" = paste0(
        format(sum(FC_ANC28_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ), 
    
       "MNH01 Ultrasound (optional)" = paste0(
        format(sum(!is.na(M01_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M01_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(!is.na(M04_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M04_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% `colnames<-`(c(.[1,]))  %>% as.data.frame() %>% 
  slice(-1) %>% 
      add_column(
      .before = 1,
      "All sites" = Form_Completion_Anc %>% 
        plyr::summarise(
                      
    "Denominator" = paste0(
        format(sum(FC_ANC28_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ), 

       "MNH01 Ultrasound (optional)" = paste0(
        format(sum(!is.na(M01_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M01_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(!is.na(M04_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M04_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # 
       "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_3) & ANC28_PASS == 1, na.rm = TRUE)/sum(FC_ANC28_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>% 
        t() %>% `colnames<-`(c(.[1,])) %>% 
        as.data.frame() %>% unlist() 
)

```

```{r ANC 32 FC}
#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i 
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

ANC32 <- Form_Completion_Anc %>% 
    rowwise() %>% 
    group_by(SITE) %>% 
    summarise(
                  
    "Denominator" = paste0(
        format(sum(FC_ANC32_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ), 
      
   "MNH01 Ultrasound" = paste0(
        format(sum(!is.na(M01_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M01_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(!is.na(M04_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M04_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH25 Maternal Lab" = paste0(
        format(sum(!is.na(M25_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M25_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"), 
   
      "MNH26 Maternal Fatigue" = paste0(
        format(sum(!is.na(M26_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M26_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%

  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,]))  %>% 
  slice(-1) %>% 
      add_column(
      .before = 1,
      "All sites" = Form_Completion_Anc %>% 
        plyr::summarise(
                            
    "Denominator" = paste0(
        format(sum(FC_ANC32_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ), 

    "MNH01 Ultrasound" = paste0(
        format(sum(!is.na(M01_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M01_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(!is.na(M04_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M04_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # 
       "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      "MNH25 Maternal Lab" = paste0(
        format(sum(!is.na(M25_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M25_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH26 Maternal Fatigue" = paste0(
        format(sum(!is.na(M26_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M26_VISIT_COMPLETE_4) & ANC32_PASS == 1, na.rm = TRUE)/sum(FC_ANC32_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%

        t() %>% 
        as.data.frame() %>% 
      `colnames<-`(c(.[1,])) %>%  unlist() 
)

```

```{r ANC36 FC}
#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i 
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

ANC36 <- Form_Completion_Anc %>% 
    rowwise() %>% 
    group_by(SITE) %>% 
    summarise(
                        
    "Denominator" = paste0(
        format(sum(FC_ANC36_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ), 
      
       "MNH01 Ultrasound (optional)" = paste0(
        format(sum(!is.na(M01_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M01_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),


      "MNH04 ANC Clinical Status" = paste0(
        format(sum(!is.na(M04_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M04_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% `colnames<-`(c(.[1,]))  %>% as.data.frame() %>% 
  slice(-1) %>% 
      add_column(
      .before = 1,
      "All sites" = Form_Completion_Anc %>% 
        plyr::summarise(
                            
    "Denominator" = paste0(
        format(sum(FC_ANC36_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ), 
          
       "MNH01 Ultrasound (optional)" = paste0(
        format(sum(!is.na(M01_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M01_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH04 ANC Clinical Status" = paste0(
        format(sum(!is.na(M04_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M04_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH05 Maternal Anthropometry" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      
      "MNH07 Maternal Specimen" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # 
       "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_5) & ANC36_PASS == 1, na.rm = TRUE)/sum(FC_ANC36_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
        t() %>% `colnames<-`(c(.[1,])) %>% 
        as.data.frame() %>% unlist() 
)

```

```{r PRISMA TABLE 7 OUT}
bind_rows(ga_tb, 
          ENROLLMENT, 
          ANC20,
          ANC28, 
          ANC32, 
          ANC36
          ) %>% 
  `rownames<-`(c(" ",
                 ## ANCLESS20 (2-10)
                 "Denominator, n",
                 "MNH01 Ultrasound", 
                 "MNH02 Enrollment Status", 
                 "MNH03 Sociodemographic", 
                 "MNH04 ANC Clinical Status",
                 "MNH05 Maternal Anthropometry",
                 "MNH06 Maternal POC",
                 "MNH07 Maternal Specimen",
                 "MNH08 Maternal Lab",
                 ## ANC20 (11-19)
                 "Denominator, n ",
                 "MNH01 Ultrasound (optional) ",
                 "MNH04 ANC Clinical Status ",
                 "MNH05 Maternal Anthropometry ",
                 "MNH06 Maternal POC ",
                 "MNH07 Maternal Specimen ",
                 "MNH08 Maternal Lab ",
                 "MNH25 Maternal Depression ",
                 "MNH26 Maternal Fatigue^1^ ",
                 ## ANC28 (20-26)
                 "Denominator, n  ",
                 "MNH01 Ultrasound (optional)  ",
                 "MNH04 ANC Clinical Status  ",
                 "MNH05 Maternal Anthropometry  ",
                 "MNH06 Maternal POC  ",
                 "MNH07 Maternal Specimen  ",
                 "MNH08 Maternal Lab  ",
                 ## ANC32 (27-35)
                 "Denominator, n   ",
                 "MNH01 Ultrasound   ",
                 "MNH04 ANC Clinical Status   ",
                 "MNH05 Maternal Anthropometry   ",
                 "MNH06 Maternal POC   ",
                 "MNH07 Maternal Specimen   ",
                 "MNH08 Maternal Lab   ",
                 "MNH25 Maternal Depression   ",
                 "MNH26 Maternal Fatigue^1^   ",
                 ##ANC36 (36-42)
                 "Denominator, n    ",
                 "MNH01 Ultrasound (optional)    ",
                 "MNH04 ANC Clinical Status    ",
                 "MNH05 Maternal Anthropometry    ",
                 "MNH06 Maternal POC    ",
                 "MNH07 Maternal Specimen    ",
                 "MNH08 Maternal Lab    "
                 )
               )  %>% 
  mutate_all(funs(str_replace(., "NaN", "0"))) %>% 
  kbl(caption = "", booktabs = TRUE) %>% #longtable = TRUE, 
    # footnote(alphabet = c("denominator is n completed any form with any visit status AND visit type=Enrollment AND passed late window with >19 weeks gestation",
    #                   "denominator is n completed any form with any visit status AND visit type=ANC20 AND passed late window with >22 weeks gestation",
    #                   "denominator is n completed any form with any visit status AND visit type=ANC28 AND passed late window with >30 weeks gestation",
    #                   "denominator is n completed any form with any visit status AND visit type=ANC32 AND passed late window with>33 weeks gestation",
    #                   "denominator is n completed any form with any visit status AND visit type=ANC36 AND passed late window with >38 weeks gestation"),
    #          general = "Passed window denominators for all visits are calculated by EDD reported in MNH01 (US_EDD_BRTHDAT). If an EDD is missing, the particpant is removed from this table.", 
    #          number = "MNH26 is only filled out for ReMAPP participants",
    #          footnote_order = c("alphabet","number", "general")) %>% 
  kable_paper(bootstrap_options = "striped", 
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = c("repeat_header", "HOLD_position")) %>% 
              #latex_options = "hold_position") %>% 
  kable_styling(font_size = 13) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>% 
  row_spec(0:1, extra_css = "padding: 0.1px") %>% 
  row_spec(c(2,11,20,27,36), bold = TRUE) %>% 
  #pack_rows("MNH01 Ultrasound", 2, 5, label_row_css = "color: steelblue;") %>%
  pack_rows(paste0("Enrollment, n(%)^a^ \nTarget window: <20wks"),2, 10, 
            label_row_css = "color: steelblue;") %>% 
  pack_rows("ANC = 20, n(%)^b^ \nTarget window: 23 to 25wks", 11, 19, 
            label_row_css = "color: steelblue;") %>% 
  pack_rows("ANC = 28, n(%)^d^ \nTarget window: 26 to 30wks", 20, 26,
            label_row_css = "color: steelblue;") %>% 
  pack_rows("ANC = 32, n(%)^d^ \nTarget window: 31 to 33wks", 27, 35,
            label_row_css = "color: steelblue;") %>% 
  pack_rows("ANC = 36, n(%)^e^ \nTarget window: 34 to 38wks", 36, 42,
            label_row_css = "color: steelblue;") 

```
<span style="font-size: 88%;">
^a^ denominator is n completed any form with any visit status AND visit type=Enrollment AND passed late window with >19 weeks gestation.
<br>
^b^ denominator is n completed any form with any visit status AND visit type=ANC20 AND passed late window with >22 weeks gestation.
<br>
^c^ denominator is n completed any form with any visit status AND visit type=ANC28 AND passed late window with >30 weeks gestation. 
<br>
^d^ denominator is n completed any form with any visit status AND visit type=ANC32 AND passed late window with>33 weeks gestation.
<br>
^e^ denominator is n completed any form with any visit status AND visit type=ANC36 AND passed late window with >38 weeks gestation.
<br>
^1^ MNH26 is only filled out for ReMAPP participants. 
^Note:^Passed window denominators for all visits are calculated by EDD reported in MNH01 (US_EDD_BRTHDAT). If an EDD is missing, the particpant is removed from this table.
</span>

\newpage

#### `r emo::ji("pushpin")` Table 8: IPC Visit Completion & Protocol Compliance
*Value: Among women successfully contacted during the IPC period, are all expected forms for the visit complete? A visit is considered `complete` if the data reports the visit was conducted in person or by phone (variable name: `MAT_VISIT_MNHXX`).
<br>
```{r ipc table}

# row 1: among people with a passed window how many have an mnh09 OR mnh10 OR mnh11
# row 2: among people WITH either an 09/10/11 how many have mnh09 complete 
# row 3: among people WITH either an 09/10/11 how many have mnh10 complete 
# row 4: among people WITH either an 09/10/11 how many have mnh11 complete 

IPC_Total <- MatData_Ipc_Visits_Mat %>%
  rowwise() %>%
  group_by(SITE) %>%
  summarise(
    
  ## VISIT COMPLETION: 
      # NUM: have MNH09 or MNH10 or MNH11 with a complete visit status (variable name: `MAT_VISIT_MNHXX`).   
      # DENOM: denominator is n completed MNH09 or MNH10 or MNH11 with a complete visit status (variable name: `MAT_VISIT_MNHXX`) OR passed on-time window with >42 weeks gestation.

    "IPC" = paste0(
      format(sum(ANY_TYPE_VISIT_COMPLETE_6 == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      " (",
      format(round(sum(ANY_TYPE_VISIT_COMPLETE_6 == 1, na.rm = TRUE)/sum(IPC_PASS==1 | ANY_TYPE_VISIT_COMPLETE_6 == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      ")"),

    "total passed ipc period" = paste0(
      format(sum(IPC_PASS==1 | ANY_TYPE_VISIT_COMPLETE_6 == 1, na.rm = TRUE), nsmall = 0, digits = 2)
    )
    
  ) %>%
  
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1)  %>% 
      add_column(
      .before = 1,
      "All sites" = MatData_Ipc_Visits_Mat %>%
        plyr::summarise(
          
  ## VISIT COMPLETION: 
      # NUM: have MNH09 or MNH10 or MNH11 with a complete visit status (variable name: `MAT_VISIT_MNHXX`).   
      # DENOM: denominator is n completed MNH09 or MNH10 or MNH11 with a complete visit status (variable name: `MAT_VISIT_MNHXX`) OR passed on-time window with >42 weeks gestation.

    "IPC" = paste0(
      format(sum(ANY_TYPE_VISIT_COMPLETE_6 == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      " (",
      format(round(sum(ANY_TYPE_VISIT_COMPLETE_6 == 1, na.rm = TRUE)/sum(IPC_PASS==1 | ANY_TYPE_VISIT_COMPLETE_6 == 1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      ")"),

    "total passed ipc period" = paste0(
      format(sum(IPC_PASS==1 | ANY_TYPE_VISIT_COMPLETE_6 == 1, na.rm = TRUE), nsmall = 0, digits = 2)
    )
    
  ) %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)

IPC_Prot_Comp_Mat <- MatData_Ipc_Visits_Compliance_Mat %>%
  rowwise() %>%
  group_by(SITE) %>%
  summarise(
    
  ## PROTOCOL COMPLIANCE: 
    # NUM: have a complete visit status (variable name: `MAT_VISIT_MNHXX`).
    # DENOM: n completed MNH09 or MNH10 or MNH11 with visit status=complete.
    
    "MNH09" = paste0(
      format(sum(M09_VISIT_COMPLETE_6==1, na.rm = TRUE), nsmall = 0, digits = 2),
      " (",
      format(round(sum(M09_VISIT_COMPLETE_6==1, na.rm = TRUE)/sum(ANY_TYPE_VISIT_COMPLETE_6==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      ")"),
    
    "MNH10" = paste0(
      format(sum(M10_VISIT_COMPLETE_6==1, na.rm = TRUE), nsmall = 0, digits = 2),
      " (",
      format(round(sum(M10_VISIT_COMPLETE_6==1, na.rm = TRUE)/sum(ANY_TYPE_VISIT_COMPLETE_6==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      ")")
  ) %>%
  
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1)  %>% 
      add_column(
      .before = 1,
      "All sites" = MatData_Ipc_Visits_Compliance_Mat %>%
        plyr::summarise(

  ## PROTOCOL COMPLIANCE: 
    # NUM: have a complete visit status (variable name: `MAT_VISIT_MNHXX`).
    # DENOM: n completed MNH09 or MNH10 or MNH11 with visit status=complete.
    
    "MNH09" = paste0(
      format(sum(M09_VISIT_COMPLETE_6==1, na.rm = TRUE), nsmall = 0, digits = 2),
      " (",
      format(round(sum(M09_VISIT_COMPLETE_6==1, na.rm = TRUE)/sum(ANY_TYPE_VISIT_COMPLETE_6==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      ")"),
    
    "MNH10" = paste0(
      format(sum(M10_VISIT_COMPLETE_6==1, na.rm = TRUE), nsmall = 0, digits = 2),
      " (",
      format(round(sum(M10_VISIT_COMPLETE_6==1, na.rm = TRUE)/sum(ANY_TYPE_VISIT_COMPLETE_6==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      ")")
  ) %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)

IPC_Prot_Comp_Inf <- MatData_Ipc_Visits_Compliance_Inf %>%
  rowwise() %>%
  group_by(SITE) %>%
  summarise(
    
  ## PROTOCOL COMPLIANCE: 
    # NUM: have a complete visit status (variable name: `MAT_VISIT_MNHXX`).
    # DENOM: n completed MNH09 or MNH10 or MNH11 with visit status=complete.

    "MNH11" = paste0(
      format(sum(M11_VISIT_COMPLETE_6==1, na.rm = TRUE), nsmall = 0, digits = 2),
      " (",
      format(round(sum(M11_VISIT_COMPLETE_6==1, na.rm = TRUE)/sum(ANY_TYPE_VISIT_COMPLETE_6==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      ")")
  ) %>%
  
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1)  %>% 
      add_column(
      .before = 1,
      "All sites" = MatData_Ipc_Visits_Compliance_Inf %>%
        plyr::summarise(

  ## PROTOCOL COMPLIANCE: 
    # NUM: have a complete visit status (variable name: `MAT_VISIT_MNHXX`).
    # DENOM: n completed MNH09 or MNH10 or MNH11 with visit status=complete.
    
    "MNH11" = paste0(
      format(sum(M11_VISIT_COMPLETE_6==1, na.rm = TRUE), nsmall = 0, digits = 2),
      " (",
      format(round(sum(M11_VISIT_COMPLETE_6==1, na.rm = TRUE)/sum(ANY_TYPE_VISIT_COMPLETE_6==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      ")")
  ) %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)



```

```{r PRISMA TABLE 8 OUT}

bind_rows(IPC_Total, IPC_Prot_Comp_Mat, IPC_Prot_Comp_Inf) %>% 
  `rownames<-`(c("IPC (Target window: Delivery to 72 hours)",
                 "Denominator, n",
                 "MNH09 Labor & Delivery", 
                 "MNH10 Maternal Post-Delivery Outcome", 
                 "MNH11 Newborn Birth Outcome"))  %>% 
  mutate_all(funs(str_replace(., "NaN", "0"))) %>% 
  kbl(caption = "", booktabs = TRUE) %>% #longtable = TRUE, 
  kable_paper(bootstrap_options = "striped", 
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = c("repeat_header", "HOLD_position")) %>% 
  kable_styling(font_size = 13) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>% 
  row_spec(0:1, extra_css = "padding: 0.1px") %>% 
  pack_rows(paste0("IPC Visit Completion^a,b^"),1, 2, 
            label_row_css = "color: steelblue;") %>% 
  pack_rows("Maternal IPC Protocol Compliance^c,d^", 3, 4, 
            label_row_css = "color: steelblue;") %>% 
  pack_rows("Infant IPC Protocol Compliance^e,f^", 5, 5, 
            label_row_css = "color: steelblue;") 

```
<span style="font-size: 88%;">
^a^ numerator: n mom with MNH09 or MNH10 or MNH11 with a complete visit status (variable name: `MAT_VISIT_MNHXX`).
<br>
^b^ denominator: n mom completed MNH09 or MNH10 or MNH11 with a complete visit status (variable name: `MAT_VISIT_MNHXX`) OR passed late window with >42 weeks gestation.
<br>
^c^ numerator: n mom with a complete visit status (variable name: `MAT_VISIT_MNHXX`).
<br>
^d^ denominator: n mom completed MNH09 or MNH10 or MNH11 with visit status=complete.
<br>
^e^ numerator: n infant with a complete visit status (variable name: `MAT_VISIT_MNHXX`).
<br>
^f^ denominator: n mom-infant pair completed MNH09 or MNH10 or MNH11 with visit status=complete.
</span>

\newpage


#### `r emo::ji("pushpin")` Figure 2: Participants with gestational age >42 weeks with no pregnancy outcome
*Value: Distribution of women who have not yet reported a pregnancy outcome with gestational age >= 42 weeks. 
<br>
```{r ipc fig 2}

## histogram of participants who have not yet delivered and have GA >42 weeks (300 days)
Gestage_Greater42 <- MatData_Screen_Enroll %>% 
  # only include participants who are enrolled and who do not have a pregnancy end (ENDPREG_DAYS == NA)
  filter(ENROLL==1, is.na(ENDPREG_DAYS)) %>% 
  select(SITE, MOMID, PREGID, INFANTID, contains("GESTAGE_AT_VISIT_DAYS")) %>% 
  # pivot longer to collapse all GA at visits into a single column called "GESTAGE_AT_VISIT_DAYS"
  pivot_longer(cols = -c(SITE, MOMID, PREGID, INFANTID),
               values_to = "GESTAGE_AT_VISIT_DAYS") %>%
  # extract any GESTAGE_AT_VISIT_DAYS >= 300 days
  filter(GESTAGE_AT_VISIT_DAYS >= 300)

ggplot(data = Gestage_Greater42, aes(x = GESTAGE_AT_VISIT_DAYS)) + 
  geom_histogram() + 
  facet_grid(rows = vars(SITE)) + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position="bottom",
        legend.title = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_x_continuous(breaks = c(300,307,314,321),
                     label = c("42", "43", "44", "45"), 
                     limits = c(300,321)) +
  xlab("Gestational Age (weeks)") +
  ylab("Count") 

```

\newpage

#### `r emo::ji("pushpin")` Table 9: PNC Protocol Compliance
*Value: Among women successfully contacted during the PNC period, are all expected forms for the visit complete? A visit is considered `complete` if the data reports the visit was conducted in person or by phone (variable name: `MAT_VISIT_MNHXX`). Goal: 100% completion for all forms, except MNH08 where lab results are expected to lag*
<br>

*Numerator:* By form: visit type = i (variable name: `TYPE_VISIT`) AND have a complete visit status (variable name: `MAT_VISIT_MNHXX`) AND passed late window for visit type = i
<br>
*Denominator:* Any form with visit type = i (variable name: `TYPE_VISIT`) AND have have a complete visit status (variable name: `MAT_VISIT_MNHXX`) AND passed late window for visit type = i

```{r birthoutcome PC}
## ANC visits - ultrasound form
# denominator: BIRTH_OUTCOME_YN = n who have a birth outcome
# Participants are included in the numerator of this table if, for each form, they have visit type = i AND have any visit status AND passed window for visit type = 1. Participants are included Visit status is defined by MAT_VISIT_MNHxx variables in each form.*
birthoutcome <- MatData_Pnc_Visits %>%
  group_by(SITE) %>%
  summarise(
  "total birth outcomes" = paste0(
    "(n=",sum(BIRTH_OUTCOME_YN==1, na.rm = TRUE), ")"
  )
  ) %>% ungroup() %>%
  t() %>%
  as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
  add_column(
    .before = 1,
    "All sites" = MatData_Pnc_Visits %>%
 plyr::summarise(
     "total birth outcomes" = paste0(
    "(n=",sum(BIRTH_OUTCOME_YN==1, na.rm = TRUE),")"
  )) %>%
      t() %>% as.data.frame() %>% unlist()
  )


```

```{r PNC0 PC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i
PNC0 <- Prot_Compliance_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(PC_PNC0_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_7 == 1 & PNC0_PASS == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_7 == 1 & PNC0_PASS == 1, na.rm = TRUE)/sum(PC_PNC0_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_7==1 & PC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_7==1 & PNC0_PASS == 1, na.rm = TRUE)/sum(PC_PNC0_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%

  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(PC_PNC0_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_7==1 & PC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_7==1& PNC0_PASS == 1, na.rm = TRUE)/sum(PC_PNC0_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_7==1 & PC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_7==1 & PNC0_PASS == 1, na.rm = TRUE)/sum(PC_PNC0_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PNC1 PC}


PNC1 <- Prot_Compliance_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(PC_PNC1_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_8 == 1 & PC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_8 == 1& PNC1_PASS == 1, na.rm = TRUE)/sum(PC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_8 == 1 & PC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_8 == 1 & PNC1_PASS == 1, na.rm = TRUE)/sum(PC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(PC_PNC1_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_8 == 1 & PC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_8 == 1& PNC1_PASS == 1, na.rm = TRUE)/sum(PC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_8 == 1 & PC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_8 == 1 & PNC1_PASS == 1, na.rm = TRUE)/sum(PC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"))
  %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PNC4 PC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

PNC4 <- Prot_Compliance_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(PC_PNC4_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_9 == 1 & PC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_9 == 1& PNC4_PASS == 1, na.rm = TRUE)/sum(PC_PNC4_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_9 == 1 & PC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_9 == 1 & PNC4_PASS == 1, na.rm = TRUE)/sum(PC_PNC4_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%

  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(PC_PNC4_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_9 == 1 & PC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_9 == 1& PNC4_PASS == 1, na.rm = TRUE)/sum(PC_PNC4_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_9 == 1 & PC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_9 == 1 & PNC4_PASS == 1, na.rm = TRUE)/sum(PC_PNC4_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")

      )
  %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PNC6 PC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

PNC6 <- Prot_Compliance_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(PC_PNC6_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH05 Maternal Anthropometrics" = paste0(
        format(sum(M05_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_10 == 1& PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_10 == 1& PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH07 Maternal Specimen Collection" = paste0(
        format(sum(M07_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_10 == 1& PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_10 == 1& PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_10 == 1 & PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      "MNH25 Maternal Depression" = paste0(
        format(sum(M25_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M25_VISIT_COMPLETE_10 == 1 & PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(PC_PNC6_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH05 Maternal Anthropometrics" = paste0(
        format(sum(M05_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_10 == 1& PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_10 == 1& PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH07 Maternal Specimen Collection" = paste0(
        format(sum(M07_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_10 == 1& PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_10 == 1& PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_10 == 1 & PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

    "MNH25 Maternal Depression" = paste0(
        format(sum(M25_VISIT_COMPLETE_10 == 1 & PC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M25_VISIT_COMPLETE_10 == 1 & PNC6_PASS == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"))
  %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PNC26 PC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

PNC26 <- Prot_Compliance_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(PC_PNC26_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH05 Maternal Anthropometrics" = paste0(
        format(sum(M05_VISIT_COMPLETE_11 == 1 & PC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_11 == 1& PNC26_PASS == 1, na.rm = TRUE)/sum(PC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_11 == 1 & PC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_11 == 1& PNC26_PASS == 1, na.rm = TRUE)/sum(PC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH07 Maternal Specimen Collection" = paste0(
        format(sum(M07_VISIT_COMPLETE_11 == 1 & PC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_11 == 1& PNC26_PASS == 1, na.rm = TRUE)/sum(PC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_11 == 1 & PC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_11 == 1& PNC26_PASS == 1, na.rm = TRUE)/sum(PC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_11 == 1 & PC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_11 == 1 & PNC26_PASS == 1, na.rm = TRUE)/sum(PC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(PC_PNC26_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH05 Maternal Anthropometrics" = paste0(
        format(sum(M05_VISIT_COMPLETE_11 == 1 & PC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_11 == 1& PNC26_PASS == 1, na.rm = TRUE)/sum(PC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_11 == 1 & PC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_11 == 1& PNC26_PASS == 1, na.rm = TRUE)/sum(PC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH07 Maternal Specimen Collection" = paste0(
        format(sum(M07_VISIT_COMPLETE_11 == 1 & PC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M07_VISIT_COMPLETE_11 == 1& PNC26_PASS == 1, na.rm = TRUE)/sum(PC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH08 Maternal Lab" = paste0(
        format(sum(M08_VISIT_COMPLETE_11 == 1 & PC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M08_VISIT_COMPLETE_11 == 1& PNC26_PASS == 1, na.rm = TRUE)/sum(PC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_11 == 1 & PC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_11 == 1 & PNC26_PASS == 1, na.rm = TRUE)/sum(PC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PNC52 PC}

PNC52 <- Prot_Compliance_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(PC_PNC52_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

     "MNH05 Anthropometrics" = paste0(
        format(sum(M05_VISIT_COMPLETE_12 == 1 & PC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_12 == 1& PNC52_PASS == 1, na.rm = TRUE)/sum(PC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),


      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_12 == 1 & PC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_12 == 1& PNC52_PASS == 1, na.rm = TRUE)/sum(PC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_12 == 1 & PC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_12 == 1 & PNC52_PASS == 1, na.rm = TRUE)/sum(PC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Prot_Compliance_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(PC_PNC52_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

    "MNH05 Anthropometrics" = paste0(
        format(sum(M05_VISIT_COMPLETE_12 == 1 & PC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M05_VISIT_COMPLETE_12 == 1& PNC52_PASS == 1, na.rm = TRUE)/sum(PC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH06 Maternal POC" = paste0(
        format(sum(M06_VISIT_COMPLETE_12 == 1 & PC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M06_VISIT_COMPLETE_12 == 1& PNC52_PASS == 1, na.rm = TRUE)/sum(PC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(M12_VISIT_COMPLETE_12 == 1 & PC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(M12_VISIT_COMPLETE_12 == 1 & PNC52_PASS == 1, na.rm = TRUE)/sum(PC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")
            )
  %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PRISMA TABLE 9 OUT}
bind_rows(birthoutcome,
          PNC0,
          PNC1,
          PNC4,
          PNC6,
          PNC26,
          PNC52
          ) %>%
    `rownames<-`(c("Participants with a birth outcome, n^1^",
                 ## PNC0 (2-4)
                  "Denominator, n",
                  "MNH06 Maternal POC ",
                  "MNH12 Mat PNC Clinical Status ",
                 ## PNC1 (5-7)
                 "Denominator, n ",
                 "MNH06 Maternal POC  ",
                 "MNH12 Mat PNC Clinical Status  ",
                 ## PNC4 (8-10)
                 "Denominator, n  ",
                 "MNH06 Maternal POC   ",
                 "MNH12 Mat PNC Clinical Status   ",
                 ## PNC6 (11-17)
                 "Denominator, n   ",
                 "MNH05 Maternal Anthropometry    ",
                 "MNH06 Maternal POC    ",
                 "MNH07 Maternal Specimen    ",
                 "MNH08 Maternal Lab    ",
                 "MNH12 Mat PNC Clinical Status    ",
                 "MNH25 Maternal Depression    ",
                 ## PNC26 (18-23)
                 "Denominator, n    ",
                 "MNH05 Maternal Anthropometry     ",
                 "MNH06 Maternal POC     ",
                 "MNH07 Maternal Specimen     ",
                 "MNH08 Maternal Lab     ",
                 "MNH12 Mat PNC Clinical Status     ",
                 ##PNC52 24-27)
                 "Denominator, n     ",
                 "MNH05 Maternal Anthropometry      ",
                 "MNH06 Maternal POC      ",
                 "MNH12 Mat PNC Clinical Status      "
                 )
               )  %>%
  mutate_all(funs(str_replace(., "NaN", "0"))) %>%
  kbl(caption = "",  booktabs = TRUE) %>% #longtable = TRUE,
    # footnote(alphabet = c("denominator is n completed any form with visit status=complete AND visit type=PNC0 AND passed late window with >5 days postpartum",
    #                   "denominator is n completed any form with visit status=complete AND visit type=PNC1 AND passed late window with 14 days postpartum",
    #                   "denominator is n completed any form with visit status=complete AND visit type=PNC4 AND passed late window with >35 days postpartum",
    #                   "denominator is n completed any form with visit status=complete AND visit type=PNC6 AND passed late window with >7 wks postpartum",
    #                   "denominator is n completed any form with visit status=complete AND visit type=PNC26 AND passed late window with >28 wks postpartum",
    #                   "denominator is n completed any form wit visit status=complete AND visit type=PNC52 AND passed late window with >54 wks postpartum"),
    #          general = "Passed window denominators for all visits are calculated by date and time of birth reported in MNH09. If an date of birth is missing, the particpant is removed from this table.",
    #          number = "n is any participant with any birth outcome defined by `BIRTH_DSTERM_INFX` in MNH09",
    #          footnote_order = c("number", "alphabet", "general")) %>%
  kable_paper(bootstrap_options = "striped",
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = c("repeat_header", "HOLD_position")) %>%
  kable_styling(font_size = 13) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>%
  row_spec(0:1, extra_css = "padding: 0.1px") %>%
  row_spec(c(2,5,8,11,18,24 ), bold = TRUE) %>%
  pack_rows(paste0("PNC = 0, n(%)^a^ \nTarget window: 3 to 5 days"),2, 4,
            label_row_css = "color: steelblue;") %>%
  pack_rows("PNC = 1, n(%)^b^ \nTarget window: 7 to 14 days", 5, 7,
            label_row_css = "color: steelblue;") %>%
  pack_rows("PNC = 4, n(%)^c^ \nTarget window: 28 to 35 days", 8, 10,
            label_row_css = "color: steelblue;") %>%
  pack_rows("PNC = 6, n(%)^d^ \nTarget window: 8 to 12 wks", 11, 17,
            label_row_css = "color: steelblue;") %>%
  pack_rows("PNC = 26, n(%)^e^ \nTarget window: 29 to 39 wks", 18, 23,
            label_row_css = "color: steelblue;") %>%
  pack_rows("PNC = 52, n(%)^f^ \nTarget window: 55 to 54 wks", 24, 27,
            label_row_css = "color: steelblue;")


```
<span style="font-size: 88%;">
^a^ denominator is n completed any form with visit status=complete AND visit type=PNC0 AND passed late window with >5 days postpartum. 
<br>
^b^ denominator is n completed any form with visit status=complete AND visit type=PNC1 AND passed late window with 14 days postpartum. 
<br>
^c^ denominator is n completed any form with visit status=complete AND visit type=PNC4 AND passed late window with >35 days postpartum. 
<br>
^d^ denominator is n completed any form with visit status=complete AND visit type=PNC6 AND passed late window with >7 wks postpartum. 
<br>
^e^ denominator is n completed any form with visit status=complete AND visit type=PNC26 AND passed late window with >28 wks postpartum. 
<br>
^f^ denominator is n completed any form wit visit status=complete AND visit type=PNC52 AND passed late window with >54 wks postpartum.
<br>
^1^ n is any participant with any birth outcome defined by `BIRTH_DSTERM_INFX` in MNH09.  
Note: Passed window denominators for all visits are calculated by date and time of birth reported in MNH09. If an date of birth is missing, the particpant is removed from this table.
</span>

\newpage

#### `r emo::ji("pushpin")` Table 10: PNC Form Completion
*Value: Are forms completed regardless of visit status? Goal: 100% completion for all forms, except MNH08 where lab results are expected to lag.*
<br>

*Numerator:* By form: visit type = i (variable name: `TYPE_VISIT`) AND have any visit status (variable name: `MAT_VISIT_MNHXX`) AND passed late window for visit type = i
<br>
*Denominator:* Any form with visit type = i (variable name: `TYPE_VISIT`) AND have any visit status (variable name: `MAT_VISIT_MNHXX`) AND passed late window for visit type = i

```{r birthoutcome FC}
## ANC visits - ultrasound form
# denominator: BIRTH_OUTCOME_YN = n who have a birth outcome
# Participants are included in the numerator of this table if, for each form, they have visit type = i AND have any visit status AND passed window for visit type = 1. Participants are included Visit status is defined by MAT_VISIT_MNHxx variables in each form.*
birthoutcome <- MatData_Pnc_Visits %>%
  group_by(SITE) %>%
  summarise(
  "total birth outcomes" = paste0(
    "(n=",sum(BIRTH_OUTCOME_YN==1, na.rm = TRUE), ")"
  )
  ) %>% ungroup() %>%
  t() %>%
  as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
  add_column(
    .before = 1,
    "All sites" = MatData_Pnc_Visits %>%
 plyr::summarise(
     "total birth outcomes" = paste0(
    "(n=",sum(BIRTH_OUTCOME_YN==1, na.rm = TRUE),")"
  )) %>%
      t() %>% as.data.frame() %>% unlist()
  )


```

```{r PNC0 FC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

PNC0 <- Form_Completion_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(FC_PNC0_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_7) & FC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_7)& PNC0_PASS == 1, na.rm = TRUE)/sum(FC_PNC0_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_7) & FC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_7) & PNC0_PASS == 1, na.rm = TRUE)/sum(FC_PNC0_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_7) & FC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_7) & PNC0_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_7) & FC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_7) & PNC0_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_7) & FC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_7) & PNC0_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"))

  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Form_Completion_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(FC_PNC0_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_7) & FC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_7)& PNC0_PASS == 1, na.rm = TRUE)/sum(FC_PNC0_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_7) & FC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_7) & PNC0_PASS == 1, na.rm = TRUE)/sum(FC_PNC0_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_7) & FC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_7) & PNC0_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_7) & FC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_7) & PNC0_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_7) & FC_PNC0_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_7) & PNC0_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"))
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PNC1 FC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

PNC1 <- Form_Completion_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(FC_PNC1_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_8) & FC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_8)& PNC1_PASS == 1, na.rm = TRUE)/sum(FC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_8) & FC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_8) & PNC1_PASS == 1, na.rm = TRUE)/sum(FC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_8) & FC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_8) & PNC1_PASS == 1, na.rm = TRUE)/sum(FC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_8) & FC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_8) & PNC1_PASS == 1, na.rm = TRUE)/sum(FC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_8) & FC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_8) & PNC1_PASS == 1, na.rm = TRUE)/sum(FC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"))

  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Form_Completion_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(FC_PNC1_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_8) & FC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_8)& PNC1_PASS == 1, na.rm = TRUE)/sum(FC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_8) & FC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_8) & PNC1_PASS == 1, na.rm = TRUE)/sum(FC_PNC1_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"))
      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_8) & FC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_8) & PNC1_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_8) & FC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_8) & PNC1_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_8) & FC_PNC1_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_8) & PNC1_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"))
  %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PNC4 FC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

PNC4 <- Form_Completion_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(FC_PNC4_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_9) & FC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_9)& PNC4_PASS == 1, na.rm = TRUE)/sum(FC_PNC4_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_9) & FC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_9) & PNC4_PASS == 1, na.rm = TRUE)/sum(FC_PNC4_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_9) & FC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_9) & PNC4_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_9) & FC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_9) & PNC4_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_9) & FC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_9) & PNC4_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"))
      #

  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Form_Completion_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(FC_PNC4_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_9) & FC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_9)& PNC4_PASS == 1, na.rm = TRUE)/sum(FC_PNC4_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_9) & FC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_9) & PNC4_PASS == 1, na.rm = TRUE)/sum(FC_PNC4_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")

      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_9) & FC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_9) & PNC4_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_9) & FC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_9) & PNC4_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_9) & FC_PNC4_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_9) & PNC4_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")")

      )
  %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PNC6 FC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

PNC6 <- Form_Completion_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(FC_PNC6_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH05 Maternal Anthropometrics" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_10)& PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_10)& PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH07 Maternal Specimen Collection" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_10)& PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_10)& PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_10) & PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_10) & PNC6_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_10) & PNC6_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_10) & PNC6_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),

      "MNH25 Maternal Depression" = paste0(
        format(sum(!is.na(M25_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M25_VISIT_COMPLETE_10) & PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Form_Completion_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(FC_PNC6_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH05 Maternal Anthropometrics" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_10)& PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_10)& PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH07 Maternal Specimen Collection" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_10)& PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_10)& PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_10) & PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),
      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_10) & PNC6_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_10) & PNC6_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_10) & PNC6_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),

    "MNH25 Maternal Depression" = paste0(
        format(sum(!is.na(M25_VISIT_COMPLETE_10) & FC_PNC6_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M25_VISIT_COMPLETE_10) & PNC6_PASS == 1, na.rm = TRUE)/sum(FC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"))
  %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PNC26 FC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

PNC26 <- Form_Completion_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(FC_PNC26_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH05 Maternal Anthropometrics" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_11)& PNC26_PASS == 1, na.rm = TRUE)/sum(FC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_11)& PNC26_PASS == 1, na.rm = TRUE)/sum(FC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH07 Maternal Specimen Collection" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_11)& PNC26_PASS == 1, na.rm = TRUE)/sum(FC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_11)& PNC26_PASS == 1, na.rm = TRUE)/sum(FC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_11) & PNC26_PASS == 1, na.rm = TRUE)/sum(FC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_11) & PNC26_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_11) & PNC26_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_11) & PNC26_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")")) %>%

  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Form_Completion_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(FC_PNC26_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

      "MNH05 Maternal Anthropometrics" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_11)& PNC26_PASS == 1, na.rm = TRUE)/sum(FC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_11)& PNC26_PASS == 1, na.rm = TRUE)/sum(FC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH07 Maternal Specimen Collection" = paste0(
        format(sum(!is.na(M07_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M07_VISIT_COMPLETE_11)& PNC26_PASS == 1, na.rm = TRUE)/sum(FC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH08 Maternal Lab" = paste0(
        format(sum(!is.na(M08_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M08_VISIT_COMPLETE_11)& PNC26_PASS == 1, na.rm = TRUE)/sum(FC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_11) & PNC26_PASS == 1, na.rm = TRUE)/sum(FC_PNC26_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%
      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_11) & PNC26_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_11) & PNC26_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_11) & FC_PNC26_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_11) & PNC26_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"))
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PNC52 FC}

#* Num (hard code in monitoring report rmd): for each form: visit type = i AND have any visit status AND passed window for visit type = i
#* Denom: Any form with visit type = i AND have any visit status AND passed window for visit type = i

PNC52 <- Form_Completion_Pnc %>%
    rowwise() %>%
    group_by(SITE) %>%
    summarise(
      "Denominator" = paste0(
        format(sum(FC_PNC52_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

     "MNH05 Anthropometrics" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_12)& PNC52_PASS == 1, na.rm = TRUE)/sum(FC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),


      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_12)& PNC52_PASS == 1, na.rm = TRUE)/sum(FC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_12) & PNC52_PASS == 1, na.rm = TRUE)/sum(FC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")) %>%

      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_12) & PNC52_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_12) & PNC52_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_12) & PNC52_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"))
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
      add_column(
      .before = 1,
      "All sites" = Form_Completion_Pnc %>%
        plyr::summarise(

      "Denominator" = paste0(
        format(sum(FC_PNC52_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)
        ),

    "MNH05 Anthropometrics" = paste0(
        format(sum(!is.na(M05_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M05_VISIT_COMPLETE_12)& PNC52_PASS == 1, na.rm = TRUE)/sum(FC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH06 Maternal POC" = paste0(
        format(sum(!is.na(M06_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M06_VISIT_COMPLETE_12)& PNC52_PASS == 1, na.rm = TRUE)/sum(FC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")"),

      "MNH12 Maternal PNC Clinical Status" = paste0(
        format(sum(!is.na(M12_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
        " (",
        format(round(sum(!is.na(M12_VISIT_COMPLETE_12) & PNC52_PASS == 1, na.rm = TRUE)/sum(FC_PNC52_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
        ")")

      # "MNH13 Infant Clinical Status" = paste0(
      #   format(sum(!is.na(M13_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M13_VISIT_COMPLETE_12) & PNC52_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH14 Infant POC Diagnostics" = paste0(
      #   format(sum(!is.na(M14_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M14_VISIT_COMPLETE_12) & PNC52_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")"),
      #
      # "MNH15 Infant Vaccination" = paste0(
      #   format(sum(!is.na(M05_VISIT_COMPLETE_12) & FC_PNC52_DENOM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
      #   " (",
      #   format(round(sum(!is.na(M05_VISIT_COMPLETE_12) & PNC52_PASS == 1, na.rm = TRUE)/sum(FC_ENROLL_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
      #   ")")

      )
  %>%
        t() %>%
        as.data.frame() %>%
      `colnames<-`(c(.[1,])) %>% unlist()
)


```

```{r PRISMA TABLE 10 OUT}
bind_rows(birthoutcome,
          PNC0,
          PNC1,
          PNC4,
           PNC6,
          PNC26,
          PNC52
          ) %>%
    `rownames<-`(c("Participants with a birth outcome,, n^1^",
                 ## PNC0 (2-4)
                  "Denominator, n",
                  "MNH06 Maternal POC ",
                  "MNH12 Mat PNC Clinical Status ",
                  # "MNH13 Inf Clinical Status",
                  # "MNH14 Inf POC",
                  # "MNH15 Inf Vaccination",
                 ## PNC1 (5-7)
                 "Denominator, n ",
                 "MNH06 Maternal POC  ",
                 "MNH12 Mat PNC Clinical Status  ",
                 # "MNH13 Inf Clinical Status ",
                 # "MNH14 Inf POC ",
                 # "MNH15 Inf Vaccination ",
                 ## PNC4 (8-10)
                 "Denominator, n  ",
                 "MNH06 Maternal POC   ",
                 "MNH12 Mat PNC Clinical Status   ",
                 # "MNH13 Inf Clinical Status  ",
                 # "MNH14 Inf POC  ",
                 # "MNH15 Inf Vaccination  ",
                 ## PNC6 (11-17)
                 "Denominator, n   ",
                 "MNH05 Maternal Anthropometry    ",
                 "MNH06 Maternal POC    ",
                 "MNH07 Maternal Specimen    ",
                 "MNH08 Maternal Lab    ",
                 "MNH12 Mat PNC Clinical Status    ",
                 "MNH25 Maternal Depression    ",
                 # "MNH13 Inf Clinical Status   ",
                 # "MNH14 Inf POC   ",
                 # "MNH15 Inf Vaccination   ",
                 ## PNC26 (18-23)
                 "Denominator, n    ",
                 "MNH05 Maternal Anthropometry     ",
                 "MNH06 Maternal POC     ",
                 "MNH07 Maternal Specimen     ",
                 "MNH08 Maternal Lab     ",
                 "MNH12 Mat PNC Clinical Status     ",
                 # "MNH13 Inf Clinical Status    ",
                 # "MNH14 Inf POC    ",
                 # "MNH15 Inf Vaccination    ",
                 ##PNC52 24-27)
                 "Denominator, n     ",
                 "MNH05 Maternal Anthropometry      ",
                 "MNH06 Maternal POC      ",
                 "MNH12 Mat PNC Clinical Status      "
                 #"MNH23 Maternal Close-out",
                 # "MNH13 Inf Clinical Status     ",
                 # "MNH14 Inf POC     ",
                 # "MNH15 Inf Vaccination     ",
                 # "MNH24 Infant Close-out"
                 )
               )  %>%
  mutate_all(funs(str_replace(., "NaN", "0"))) %>%
  kbl(caption = "", booktabs = TRUE) %>% #longtable = TRUE, 
    # footnote(alphabet = c("denominator is n completed any form with any visit status AND visit type=PNC0 AND passed late window with >5 days postpartum",
    #                   "denominator is n completed any form with any visit status AND visit type=PNC1 AND passed late window with 14 days postpartum",
    #                   "denominator is n completed any form with any visit status AND visit type=PNC4 AND passed late window with >35 days postpartum",
    #                   "denominator is n completed any form with any visit status AND visit type=PNC6 AND passed late window with >7 wks postpartum",
    #                   "denominator is n completed any form with any visit status AND visit type=PNC26 AND passed late window with >28 wks postpartum",
    #                   "denominator is n completed any form with any visit status AND visit type=PNC52 AND passed late window with >54 wks postpartum"),
    #          general = "Passed window denominators for all visits are calculated by date and time of birth reported in MNH09. If an date of birth is missing, the particpant is removed from this table.",
    #          number = "n is any participant with any birth outcome defined by `BIRTH_DSTERM_INFX` in MNH09",
    #          footnote_order = c("number", "alphabet", "general")) %>%
  kable_paper(bootstrap_options = "striped",
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = c("repeat_header", "HOLD_position")) %>%
  kable_styling(font_size = 13) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>%
  row_spec(0:1, extra_css = "padding: 0.1px") %>%
  row_spec(c(2,5,8,11,18,24 ), bold = TRUE) %>%
  pack_rows(paste0("PNC = 0, n(%)^a^ \nTarget window: 3 to 5 days"),2, 4,
            label_row_css = "color: steelblue;") %>%
  pack_rows("PNC = 1, n(%)^b^ \nTarget window: 7 to 14 days", 5, 7,
            label_row_css = "color: steelblue;") %>%
  pack_rows("PNC = 4, n(%)^c^ \nTarget window: 28 to 35 days", 8, 10,
            label_row_css = "color: steelblue;") %>%
  pack_rows("PNC = 6, n(%)^d^ \nTarget window: 6 to 7 wks", 11, 17,
            label_row_css = "color: steelblue;") %>%
  pack_rows("PNC = 26, n(%)^e^ \nTarget window: 26 to 28 wks", 18, 23,
            label_row_css = "color: steelblue;") %>%
  pack_rows("PNC = 52, n(%)^f^ \nTarget window: 52 to 54 wks", 24, 27,
            label_row_css = "color: steelblue;")


```
<span style="font-size: 88%;">
^a^ denominator is n completed any form with any visit status AND visit type=PNC0 AND passed late window with >5 days postpartum. 
<br>
^b^ denominator is n completed any form with any visit status AND visit type=PNC1 AND passed late window with 14 days postpartum. 
<br>
^c^ denominator is n completed any form with any visit status AND visit type=PNC4 AND passed late window with >35 days postpartum. 
<br>
^d^ denominator is n completed any form with any visit status AND visit type=PNC6 AND passed late window with >7 wks postpartum. 
<br>
^e^ denominator is n completed any form with any visit status AND visit type=PNC26 AND passed late window with >28 wks postpartum. 
<br>
^f^ denominator is n completed any form with any visit status AND visit type=PNC52 AND passed late window with >54 wks postpartum.
<br>
^1^ n is any participant with any birth outcome defined by `BIRTH_DSTERM_INFX` in MNH09.  
Note: Passed window denominators for all visits are calculated by date and time of birth reported in MNH09. If an date of birth is missing, the participant is removed from this table.
</span>

\newpage

### **2. ReMAPP** 


#### `r emo::ji("pushpin")` Table 1a: MNH25 Protocol Compliance
*Value: Among women successfully contacted during the ANC or PNC period, are all expected MNH25 Maternal Depression forms for the visit complete? A visit is considered `complete` if the data reports the visit was conducted in person or by phone (variable name: `MAT_VISIT_MNHXX`). MNH25 can be completed either during individual visits (e.g., ANC20) or during combined visits after the gestational age window has passed (e.g., combined Enrollment and ANC20 visits). The denominators in this table are based on the latest window for eligible visits. For example, the denominator for MNH25 completed at ANC32 is the number of participants who have passed the ANC36 late window to allow for combined visits.*
<br>
<br>

*Numerator:* MNH25 with visit type = i (variable name: `TYPE_VISIT`) AND have a complete visit status (variable name: `MAT_VISIT_MNHXX`) AND passed late window for visit type = i 
<br>
*Denominator:* Passed late window for visit type = i

```{r MNH25 PC}
    
    #* Num: MNH25 with visit status = 1 or 2 AND passed window for visit type = i 
    #* Denom: passed window for visit type = i 
    
out_tb <- Prot_Compliance_MNH25 %>% 
      rowwise() %>% 
      group_by(SITE) %>% 
      summarise(
        
      # ANC 20
        "MNH25 at ANC20^a^" = paste0(
          format(sum(M25_ANCLESS20_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M25_ANCLESS20_NUM == 1, na.rm = TRUE)/sum(PC_ANCLESS20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),
          
        "Denominator, n" = paste0(
          format(sum(PC_ANCLESS20_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)), 

      ## ANC 32
        "MNH25 at ANC32^b^" = paste0(
          format(sum(M25_ANCOVER31_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M25_ANCOVER31_NUM == 1, na.rm = TRUE)/sum(PC_ANCOVER31_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),

        "Denominator, n " = paste0(
          format(sum(PC_ANCOVER31_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)), 
        
     ### PNC 6      
     "MNH25 at PNC6^c^" = paste0(
          format(sum(M25_VISIT_COMPLETE_10 == 1 & PNC6_PASS_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M25_VISIT_COMPLETE_10 == 1 & PNC6_PASS_LATE == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),

        "Denominator, n  " = paste0(
          format(sum(PC_PNC6_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2))

      )  %>%
      t() %>% as.data.frame() %>% 
      `colnames<-`(c(.[1,])) %>% 
      slice(-1) %>% 
      add_column(
        .before = 1,
        "All sites" = Prot_Compliance_MNH25%>% 
          plyr::summarise(
      # ANC 20
        "MNH25 at ANC20^a^" = paste0(
          format(sum(M25_ANCLESS20_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M25_ANCLESS20_NUM == 1, na.rm = TRUE)/sum(PC_ANCLESS20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),
          
        "Denominator, n" = paste0(
          format(sum(PC_ANCLESS20_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)), 

      ## ANC 32
        "MNH25 at ANC32^b^" = paste0(
          format(sum(M25_ANCOVER31_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M25_ANCOVER31_NUM == 1, na.rm = TRUE)/sum(PC_ANCOVER31_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),

        "Denominator, n " = paste0(
          format(sum(PC_ANCOVER31_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)), 
        
     ### PNC 6      
     "MNH25 at PNC6^c^" = paste0(
          format(sum(M25_VISIT_COMPLETE_10 == 1 & PNC6_PASS_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M25_VISIT_COMPLETE_10 == 1 & PNC6_PASS_LATE == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),

        "Denominator, n  " = paste0(
          format(sum(PC_PNC6_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2))
            
          ) %>% 
          t() %>% 
          as.data.frame() %>% 
          `colnames<-`(c(.[1,])) %>% unlist() 
  )
      
    
```

```{r REMAPP table 1a OUT}
# out_tb %>%
#     `rownames<-`(c( ## ANC20 (1-3)
#                    "ANC20^a^",
#                    "Denominator, n",
#                    ## ANC32 (4-6)
#                    "ANC32^b^",
#                    "Denominator, n ",
#                    ## PNC6 (7-9)
#                    "PNC6^c^",
#                    "Denominator, n   "
#                    )
#                )  %>%
 out_tb %>%
  mutate_all(funs(str_replace(., "NaN", "0"))) %>%
  kbl(caption = "", booktabs = TRUE) %>% 
  kable_paper(bootstrap_options = "striped",
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = c("repeat_header", "HOLD_position")) %>%
  kable_styling(font_size = 13) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>%
  # row_spec(c(1,3,5), bold = TRUE) %>%
  add_indent(c(2, 4, 6), level_of_indent = 2)  %>%  
  pack_rows(paste0("MNH25 Maternal Depression"),1, 6,
            label_row_css = "color: steelblue;") 
  # pack_rows("ANC = 32, n(%)", 4, 6,
  #           label_row_css = "color: steelblue;") %>%
  # pack_rows("PNC = 6, n(%)^c^", 7, 9,
  #           label_row_css = "color: steelblue;") 


```
<span style="font-size: 88%;">
^a^ denominator is n passed ANC20 late window with >25 weeks gestation.
<br>
^b^ denominator is n passed ANC36 late window with >42 weeks gestation.
<br>
^c^ denominator is n passed PNC6 late window with >12 weeks postpartum.
<br>
ANC Note: Passed window denominators for ANC visits are calculated by EDD reported in MNH01 (US_EDD_BRTHDAT). If an EDD is missing, the participant is removed from this table.
<br>
PNC Note: Passed window denominators for PNC visits are calculated by date and time of birth reported in MNH09. If an date of birth is missing, the participant is removed from this table.
</span>

#### `r emo::ji("pushpin")` Table 1b: MNH26 Protocol Compliance
*Value: Among women successfully contacted during the ANC or PNC period, are all expected MNH26 Maternal Fatigue forms for the visit complete? A visit is considered `complete` if the data reports the visit was conducted in person or by phone (variable name: `MAT_VISIT_MNHXX`). The table below shows protocol compliance distributions for MNH26 forms following site launch of ReMAPP. These forms can be filled out either during individual visits (e.g., ANC20) or during combined visits after the gestational age window has passed (e.g., combined Enrollment and ANC20 visits).For example, the denominator for MNH25 completed at ANC32 is the number of participants who have passed the ANC36 late window to allow for combined visits.**
<br>
<br>

*Numerator:* MNH26 with visit type = i (variable name: `TYPE_VISIT`) AND have a complete visit status (variable name: `MAT_VISIT_MNHXX`) AND passed late window for visit type = i 
<br>
*Denominator:* Passed late window for visit type = i 

```{r MNH26 PC}
    
    #* Num: MNH26 with visit status = 1 or 2 AND passed window for visit type = i 
    #* Denom: passed window for visit type = i 
    
out_tb <- Prot_Compliance_MNH26 %>% 
      rowwise() %>% 
      group_by(SITE) %>% 
      summarise(
        
      # ANC 20
        "MNH26 at ANC20^a^" = paste0(
          format(sum(M26_ANCLESS20_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M26_ANCLESS20_NUM == 1, na.rm = TRUE)/sum(PC_ANCLESS20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),
          
        "Denominator, n" = paste0(
          format(sum(PC_ANCLESS20_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)), 

      ## ANC 32
        "MNH26 at ANC32^b^" = paste0(
          format(sum(M26_ANCOVER31_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M26_ANCOVER31_NUM == 1, na.rm = TRUE)/sum(PC_ANCOVER31_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),

        "Denominator, n " = paste0(
          format(sum(PC_ANCOVER31_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)), 
        
     ### PNC 6      
     "MNH26 at PNC6^c^" = paste0(
          format(sum(M26_VISIT_COMPLETE_10 == 1 & PNC6_PASS_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M26_VISIT_COMPLETE_10 == 1 & PNC6_PASS_LATE == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),

        "Denominator, n  " = paste0(
          format(sum(PC_PNC6_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2))

      )  %>%
      t() %>% as.data.frame() %>% 
      `colnames<-`(c(.[1,])) %>% 
      slice(-1) %>% 
      add_column(
        .before = 1,
        "All sites" = Prot_Compliance_MNH26 %>% 
          plyr::summarise(
            
      # ANC 20
        "MNH26 at ANC20^a^" = paste0(
          format(sum(M26_ANCLESS20_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M26_ANCLESS20_NUM == 1, na.rm = TRUE)/sum(PC_ANCLESS20_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),
          
        "Denominator, n" = paste0(
          format(sum(PC_ANCLESS20_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)), 

      ## ANC 32
        "MNH26 at ANC32^b^" = paste0(
          format(sum(M26_ANCOVER31_NUM == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M26_ANCOVER31_NUM == 1, na.rm = TRUE)/sum(PC_ANCOVER31_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),

        "Denominator, n " = paste0(
          format(sum(PC_ANCOVER31_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2)), 
        
     ### PNC 6      
     "MNH26 at PNC6^c^" = paste0(
          format(sum(M26_VISIT_COMPLETE_10 == 1 & PNC6_PASS_LATE == 1, na.rm = TRUE), nsmall = 0, digits = 2),
          " (",
          format(round(sum(M26_VISIT_COMPLETE_10 == 1 & PNC6_PASS_LATE == 1, na.rm = TRUE)/sum(PC_PNC6_DENOM==1, na.rm = TRUE)*100, 2), nsmall = 0, digits = 2),
          ")"),

        "Denominator, n  " = paste0(
          format(sum(PC_PNC6_DENOM==1, na.rm = TRUE), nsmall = 0, digits = 2))
            
          ) %>% 
          t() %>% 
          as.data.frame() %>% 
          `colnames<-`(c(.[1,])) %>% unlist() 
  )
      
    
```

```{r REMAPP table 1b OUT}

out_tb %>%
  mutate_all(funs(str_replace(., "NaN", "0"))) %>%
  kbl(caption = "", booktabs = TRUE) %>% 
  kable_paper(bootstrap_options = "striped",
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = c("repeat_header", "HOLD_position")) %>%
  kable_styling(font_size = 13) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>%
  row_spec(c(1,3,5), bold = TRUE) %>%
  add_indent(c(2, 4, 6), level_of_indent = 2)  %>%  
  pack_rows(paste0("MNH26 Maternal Fatigue"),1, 6,
            label_row_css = "color: steelblue;") 

```
<span style="font-size: 88%;">
^a^ denominator is n passed ANC20 late window with >25 weeks gestation.
<br>
^b^ denominator is n passed ANC36 late window with >42 weeks gestation.
<br>
^c^ denominator is n passed PNC6 late window with >12 weeks postpartum.
<br>
Note: This table includes all participants who were enrolled following site launch of ReMAPP. 
<br>
ANC Note: Passed window denominators for ANC visits are calculated by EDD reported in MNH01 (US_EDD_BRTHDAT). If an EDD is missing, the participant is removed from this table.
<br>
PNC Note: Passed window denominators for PNC visits are calculated by date and time of birth reported in MNH09. If an date of birth is missing, the participant is removed from this table.
</span>

\newpage

#### `r emo::ji("pushpin")` Table 2: ReMAPP healthy cohort eligibility
*Value: This table will be updated as lab measurements are updated and reported. Those who are unknown may move into eligible or ineligible categories based on updated lab reports. Those who are eligible were enrolled in PRISMA following the launch of ReMAPP at each site. Distributions of eligibility criteria are outlined in Table 2 below.*

```{r}

options(knitr.kable.NA = '0 (0)')


healthy_enroll <- healthyOutcome %>% 
  filter(ENROLL == 1) %>% 
  group_by(SITE) %>% 
  summarise("Total enrolled in PRISMA since ReMAPP launch" = paste0("(n=", n(), ")"),
            "Eligible for healthy cohort, n(%)" = paste0(sum(HEALTHY_ELIGIBLE == 1, na.rm=TRUE),
                                        " (", format(sum(HEALTHY_ELIGIBLE == 1, na.rm=TRUE)/sum(ENROLL == 1)*100, digits = 2, nsmall=0), ")"),
            "Ineligible for healthy cohort, n(%)" = paste0(sum(HEALTHY_ELIGIBLE == 0, na.rm=TRUE),
                             " (", format(sum(HEALTHY_ELIGIBLE == 0, na.rm=TRUE)/sum(ENROLL == 1)*100, digits = 2, nsmall=0), ")"),
            "Pending, n(%)" = paste0(sum(HEALTHY_ELIGIBLE == 3, na.rm=TRUE),
                                " (", format(sum(HEALTHY_ELIGIBLE == 3, na.rm=TRUE)/sum(ENROLL == 1)*100, digits = 2, nsmall=0), ")")
  ) %>% 
    t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .before = 1,
    "All sites" = healthyOutcome %>% 
  filter(ENROLL == 1) %>% 
  plyr::summarise("Total enrolled in PRISMA since ReMAPP launch" = paste0("(n=", sum(ENROLL==1), ")"), 
            "Eligible , n(%)" = paste0(sum(HEALTHY_ELIGIBLE == 1, na.rm=TRUE),
                                        " (", format(sum(HEALTHY_ELIGIBLE == 1, na.rm=TRUE)/sum(ENROLL==1)*100, digits = 2, nsmall=0), ")"),
            "Ineligible, n(%)" = paste0(sum(HEALTHY_ELIGIBLE == 0, na.rm=TRUE),
                             " (", format(sum(HEALTHY_ELIGIBLE == 0, na.rm=TRUE)/sum(ENROLL == 1)*100, digits = 2, nsmall=0), ")"),
            "Pending, n(%)" = paste0(sum(HEALTHY_ELIGIBLE == 3, na.rm=TRUE),
                                " (", format(sum(HEALTHY_ELIGIBLE == 3, na.rm=TRUE)/sum(ENROLL == 1)*100, digits = 2, nsmall=0), ")")
  ) %>% 
      t() %>% unlist()
  ) 
```

```{r}
bind_rows(healthy_enroll) %>% 
  kbl(caption = "") %>%
  kable_paper(bootstrap_options = "striped", 
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = "hold_position") %>% 
  kable_styling(font_size = 13) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>% 
  row_spec(0:1, extra_css = "padding: 0px") 
  # footnote(alphabet = c("denominator is n enrolled in PRISMA")) 
```
<span style="font-size: 88%;">
^a^ denominator is n enrolled in PRISMA.
</span>


#### `r emo::ji("pushpin")` Figure 1: ReMAPP healthy cohort eligibility and missingness by criteria by site.
*Value: This figure will show the distribution of each healthy cohort criteria among women enrolled in ReMAPP. Missing means missing form, missing diagnosed or measured data, note that it includes pending data (test not performed yet or result pending).* 

```{r remapp figure 1}
plot_criteria <- df_eli_long 

plot_criteria %>%
  ggplot(aes(y = reorder(Variable, desc(Variable)), fill = Value)) + 
  geom_bar(alpha = 0.9, aes(x = (..count..)/sum(..count..)), position = position_fill(reverse = TRUE)) +
  scale_x_continuous(labels=percent) + 
  scale_y_discrete(limits = rev(levels("Variable"))) +
  scale_fill_manual(
    values = c("#43bfc7","#F0833A","lightgrey"), 
    drop = FALSE) + 
  xlab("") + 
  ylab("") +
  facet_grid(~SITE, scales = "free_y", margins = FALSE) + 
  theme_bw() +  
  theme(strip.background=element_rect(fill="white"),
        axis.text = element_text(size = 7),
        axis.text.x = element_text(size = 6),
        legend.key.size = unit(0.38,"cm"),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),)
```
<br>
<br>
<span style="font-size: 88%;">
**Explanation of variable C1-C19:**
<br>
* C1 -- CRIT_AGE: Aged 18 to 34 years;
<br>
* C2 -- CRIT_GA: Gestational age <14 weeks 
<br>
* C3 -- CRIT_BMI_MUAC: Pre-pregnancy or early pregnancy body mass index (BMI) of >18.5 and <30 kg/m2 AND mid-upper arm circumference (MUAC) > 23cm 
<br>
* C4 -- CRIT_HEIGHT: Height ≥150 cm 
<br>
* C5 -- CRIT_SINGLEPREG: Singleton pregnancy 
<br>
* C6 -- CRIT_IRON: Not iron deficient (serum ferritin >15 mcg/L– adjusted for inflammation) 
<br>
* C7 -- CRIT_INFLAM: No subclinical inflammation (CRP≤5 and/or AGP≤1)
<br>
* C8 -- CRIT_BP: Systolic blood pressure <140 mmHg and diastolic blood pressure <90 mmHg 
<br>
* C9 -- CRIT_LBW: No previous reported low birth weight delivery
<br>
* C10 -- CRIT_STILLBIRTH: No previous reported stillbirth
<br>
* C11 -- CRIT_UNPL_CESARIAN: No previous reported unplanned cesarean delivery
<br>
* C12 -- CRIT_HEMOGLOBINOPATHIES: No hemoglobinopathies: SS, SC, SE, EE, CC, SD-Punjab, Sβthal, Eβthal, Cβthal, CD-Punjab, ED-Punjab, D-D-Punjab, D-Punjabβthal, Thalassemia major, Thalassemia intermedia, glucose-6-phosphate dehydrogenase deficiency, or Alpha thalassemia
<br>
* C13 -- CRIT_SMOKE: No reported cigarette smoking, tobacco chewing, or betel nut use during pregnancy
<br>
* C14 -- CRIT_DRINK: No reported alcohol consumption during pregnancy
<br>
* C15 -- CRIT_CHRONIC: No known history or current chronic disease including cancer, kidney disease, and cardiac conditions
<br>
* C16 -- CRIT_HIV: No known history or current HIV
<br>
* C17 -- CRIT_MALARIA: No current malaria infection (per rapid diagnostic test)
<br>
* C18 -- CRIT_HEPATITISB: No current Hepatitis B virus infection (per rapid diagnostic test)
<br>
* C19 -- CRIT_HEPATITISC: No current Hepatitis C virus infection (per rapid diagnostic test)
<br>
</span>

\newpage

#### `r emo::ji("pushpin")` Table 3: CBC Hemoglobin measurements for participants in ReMAPP per visit. 
*Value: Were all the required CBC hemoglobin measurements taken as directed by the protocol?* 

```{r REMAPP Table 3}
## denominators: 
  # DenHBV1 = MNH08 completed with visit type = 1 AND visit status = 1/2 OR enrollment overdue
  # DenHBV2 = MNH08 completed with visit type = 2 AND visit status = 1/2 AND GA at enrollment <= 17wks OR ANC20 overdue
  # DenHBV3 = MNH08 completed with visit type = 3 AND visit status = 1/2 OR ANC28 overdue
  # DenHBV5 = MNH08 completed with visit type = 5 AND visit status = 1/2 OR ANC36 overdue

remapp_table3 <- MatData_Hb_Visit %>%
  group_by(SITE) %>%
    summarise(
          "total enrolled" = paste0(
            "(n=", n(),")"
          ),
            "Enrollment" = paste0(sum(HB_COMPLETED_1 == 1, na.rm = TRUE),
                                        " (", format(sum(HB_COMPLETED_1 == 1, na.rm = TRUE)/sum(DenHBV1 == 1, na.rm = TRUE)*100, digits = 2, nsmall=0), ")"),
            "ANC20" = paste0(sum(HB_COMPLETED_2 == 1, na.rm = TRUE),
                                        " (", format(sum(HB_COMPLETED_2 == 1, na.rm = TRUE)/sum(DenHBV2 == 1, na.rm = TRUE)*100, digits = 2, nsmall=0), ")"),
            "ANC28" = paste0(sum(HB_COMPLETED_3 == 1, na.rm = TRUE),
                                        " (", format(sum(HB_COMPLETED_3 == 1, na.rm = TRUE)/sum(DenHBV3 == 1, na.rm = TRUE)*100, digits = 2, nsmall=0), ")"),
  
            "ANC36" = paste0(sum(HB_COMPLETED_5 == 1, na.rm = TRUE),
                                        " (", format(sum(HB_COMPLETED_5 == 1, na.rm = TRUE)/sum(DenHBV5 == 1, na.rm = TRUE)*100, digits = 2, nsmall=0), ")")
  
            # "PNC6" = paste0(sum(HB_COMPLETED_10 == 1),
            #                             " (", format(sum(HB_COMPLETED_10 == 1)/sum(d == 1, na.rm = TRUE)*100, digits = 2, nsmall=0), ")")
  
) %>%
  t() %>% as.data.frame() %>%
  `colnames<-`(c(.[1,])) %>%
  slice(-1) %>%
  add_column(
    .before = 1,
    "All sites" = MatData_Hb_Visit %>%
    plyr::summarise(
          "total enrolled" = paste0(
            "(n=", sum(ENROLL_DENOM == 1, na.rm=TRUE),")"),
          
            "Enrollment" = paste0(sum(HB_COMPLETED_1 == 1, na.rm = TRUE),
                                        " (", format(sum(HB_COMPLETED_1 == 1, na.rm = TRUE)/sum(DenHBV1 == 1, na.rm = TRUE)*100, digits = 2, nsmall=0), ")"),
            "ANC20" = paste0(sum(HB_COMPLETED_2 == 1, na.rm = TRUE),
                                        " (", format(sum(HB_COMPLETED_2 == 1, na.rm = TRUE)/sum(DenHBV2 == 1, na.rm = TRUE)*100, digits = 2, nsmall=0), ")"),
            "ANC28" = paste0(sum(HB_COMPLETED_3 == 1, na.rm = TRUE),
                                        " (", format(sum(HB_COMPLETED_3 == 1, na.rm = TRUE)/sum(DenHBV3 == 1, na.rm = TRUE)*100, digits = 2, nsmall=0), ")"),
  
            "ANC36" = paste0(sum(HB_COMPLETED_5 == 1, na.rm = TRUE),
                                        " (", format(sum(HB_COMPLETED_5 == 1, na.rm = TRUE)/sum(DenHBV5 == 1, na.rm = TRUE)*100, digits = 2, nsmall=0), ")")
  
            # "PNC6" = paste0(sum(HB_COMPLETED_10 == 1),
            #                             " (", format(sum(HB_COMPLETED_10 == 1)/sum(d == 1, na.rm = TRUE)*100, digits = 2, nsmall=0), ")")
  
) %>%
      t() %>% unlist()
  )

```

```{r REMAPP Table 3 Out}
remapp_table3 %>% 
    `rownames<-`(c(" ",
                  "ANC < 20, n(%)^a^",
                  "ANC = 20, n(%)^b^",
                  "ANC = 28, n(%)^c^",
                  "ANC = 36, n(%)^d^")) %>%
  mutate_all(funs(str_replace(., "NaN", "0"))) %>% 
  kbl(caption = "") %>%
  kable_paper(bootstrap_options = "striped", 
              full_width = T, html_font = "Cambria", position = "left",
              latex_options = "hold_position") %>% 
  kable_styling(font_size = 13) %>%
  row_spec(0, extra_css = "border-bottom: 0px white;") %>% 
  row_spec(0:1, extra_css = "padding: 0px")
  # footnote(alphabet = c("denominator is n enrolled", 
  #                     "denominator is n completed MNH-08 with visit type=ANC20 OR missed on-time window with >22 weeks gestation",
  #                     "denominator is n completed  MNH-08 with visit type=ANC28  OR missed on-time window with >30 weeks gestation",
  #                     "denominator is n completed  MNH-08 with visit type=ANC36  OR missed on-time window with >38 weeks gestation"
  #                      )) 
  # pack_rows("ANC < 20, n(%)^a^", 2, 2, label_row_css = "color: steelblue;") %>% 
  # pack_rows("ANC = 20, n(%)^b^", 3, 3, label_row_css = "color: steelblue;") %>% 
  # pack_rows("ANC = 28, n(%)^c^", 4, 4, label_row_css = "color: steelblue;") %>% 
  # pack_rows("ANC = 32, n(%)^d^", 5, 5, label_row_css = "color: steelblue;") %>% 
  # pack_rows("ANC = 36, n(%)^e^", 6, 6, label_row_css = "color: steelblue;") 

```
<span style="font-size: 88%;">
^a^ denominator is n enrolled. 
<br>
^b^ denominator is n completed MNH-08 with visit type=ANC20 OR missed on-time window with >22 weeks gestation.
<br>
^c^ denominator is n completed  MNH-08 with visit type=ANC28  OR missed on-time window with >30 weeks gestation. 
<br>
^d^ denominator is n completed  MNH-08 with visit type=ANC36  OR missed on-time window with >38 weeks gestation. 
<br>
</span>

&nbsp;
&nbsp;

\newpage

#### `r emo::ji("pushpin")` Figure 2: Hemoglobin measures by gestational age for participants enrolled in PRISMA MNH 

```{r, Remapp Figure 2}
## x axis in weeks 
#MatData_HB_GA_Visit_Kenya <- MatData_HB_GA_Visit %>% filter(SITE == "Kenya")
# ggplot(data = MatData_Hb_GA_Visit, 
#              aes(x = GA_WKS, y = RESULT, group = TEST, color = TEST), ) + 
#   geom_point(alpha = 0.75)  + 
#     facet_grid(rows = vars(SITE)) + 
#     theme_bw() +
#     ylim(0,20) + 
#     theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
#         legend.position="bottom",
#         legend.title = element_blank(),
#         panel.grid.minor = element_blank()) +
#   scale_x_continuous(n.breaks = 10) + 
#   xlab("Gestational Age (weeks)") +
#   ylab("Hemoglobin (g/dL)") + 
#   scale_color_brewer(palette="Set1")  
  
## x axis in days
MatData_Hb_GA_Visit <- MatData_Hb_GA_Visit %>% filter(GA > 0)

ggplot(data = MatData_Hb_GA_Visit,
             aes(x = GA, y = RESULT, group = TEST, color = TEST), ) +
  geom_point(alpha = 0.25)  +
    facet_grid(rows = vars(SITE)) +
    theme_bw() +
    ylim(0,20) +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position="bottom",
        legend.title = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_x_continuous(breaks = c(0,49,98,147,198,245),
                     label = c("0", "7", "14", "21", "28", "35"), 
                     limits = c(0,245)) +
  xlab("Gestational Age (weeks)") +
  ylab("Hemoglobin (g/dL)") +
  scale_color_brewer(palette="Set1")

```

